<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>SciSDK Library: Custom Packet driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/NuclearInstruments/SCISDK" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sci-compiler-logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SciSDK Library
   </div>
   <div id="projectbrief">SDK for SciCompiler projects</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_custompacket.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Custom Packet driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The custom packet allows to transfer data from FPGA to the PC in list mode.</p>
<p>The custom packet is particular version of the list where the user can define the data packet format.</p>
<p><img src="cp01.png" alt="" class="inline"/> <br  />
</p>
<p>In respect to the list the custom packet has a structured data type and can be decoded by the custom packet decoder.</p>
<p>In order to decode the custom packet it is raccomanded that the first dword (32 bit) of the custom packet is a fixed constant. This is the align world, which is exported by SciCompiler and can be used to align the custom packet. Aldo is not mandatory to have an align world, this world reduce the propability that in case of lost data, all data in the packet got lost.</p>
<p>The JSON that SciCompiler generates for the custom packet contains the description for every words. Most of programming language do not allows to define data type at runtime indeed it is necessary that the user define the struct in the source code and cast the data pointer to it. When custom packet is used in raw mode, it can be consider a list In the end, the custom packet is no more than a list with a wrapper to format the FPGA data word</p>
<p>The list inside the custom packet is a FIFO buffer. The buffer is allocated in the FPGA and the data are transferred to the PC. On some board it is possible to enable DMA to speed up transfer. On the PC side a buffer can be allocated using the <code>SCISDK_AllocateBuffer</code> function. The buffer is freed using the <code>SCISDK_FreeBuffer</code> function.</p>
<p><b>Decoded Mode</b> Because the List is a FIFO is not possible to know a priori the number of bytes that will be transferred. The <code>SCISDK_AllocateBuffer</code> take indeed an extra parameter to specify the size of the buffer (in packets) on the PC side; the <code>SCISDK_ReadData</code> function will try to read the maximum number of bytes that can fit in the buffer.</p>
<p><em>It is important to note that the buffer size is specified in packets and not in bytes. The FPGA packet size is specified in SciCompiler (i the example in the figure above the packet size is 5 DWORD, that means 5*32bit = 160bit or 20 bytes). This is always a multiple of 32 bits (DWORD). All transfer will always be done with a size multiple of the FPGA packet size. This ensure that is not possible to read partial packet that will corrupt data in an urecoverable way</em></p>
<p><b>Raw Mode</b> In raw mode the costom packet do not process packet and ignore the information on packet size and structure present in the JSON. It assume that the packet size is 1 DWORD and the last argument of <code>SCISDK_AllocateBuffer</code> specify the size in DWORD of the user buffer. <code>SCISDK_ReadData</code> will try to fill this buffer that is no more alligned to packet size.</p>
<p>The readout can be configure to work in two different mode:</p><ul>
<li>blocking : the <code>SCISDK_ReadData</code> function will block until the buffer is full or the timeout is reached.</li>
<li>non-blocking : the <code>SCISDK_ReadData</code> function will return immediately with the number of bytes read.</li>
</ul>
<p>More over the list can be configured to work:</p><ul>
<li>polling : the <code>SCISDK_ReadData</code> function will read the data from the hardware FIFO when the user call the function.</li>
<li>threaded : on start command, the list will start a thread that will read the data from the hardware FIFO and store it in an internal buffer (thread buffer). The <code>SCISDK_ReadData</code> function will read the data from the thread buffer. Thread mode increase the perfomance of the list because, while the use elaborate the previous data, the list accumulate next data in the thread buffer.</li>
</ul>
<h1><a class="anchor" id="autotoc_md97"></a>
Parameters</h1>
<p>The following parameters can be configured:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Acces Mode   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">acq_len   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">maximum number of sample to be transferred per physical FIFO access   </td><td class="markdownTableBodyNone">1024    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">acq_mode   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">select blocking/non-blocking mode   </td><td class="markdownTableBodyNone">blocking    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">timeout   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">set the timout in ms in blocking mode   </td><td class="markdownTableBodyNone">100    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">thread   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">enable the internal thread: true/false   </td><td class="markdownTableBodyNone">false    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">high_performance   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">if true the internal FIFO access lock the bus in priority mode.   </td><td class="markdownTableBodyNone">false    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">threaded_buffer_size   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">size in dword of the internal buffer   </td><td class="markdownTableBodyNone">100000    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">check_align_word   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">if true, check the packet alignment   </td><td class="markdownTableBodyNone">false    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">data_processing   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">set data processing mode: raw, decode   </td><td class="markdownTableBodyNone">decode    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">buffer_type   </td><td class="markdownTableBodyNone">R   </td><td class="markdownTableBodyNone">get buffer type: <a class="el" href="struct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___r_a_w___b_u_f_f_e_r.html" title="Oscilloscope raw data type.">SCISDK_OSCILLOSCOPE_RAW_BUFFER</a> or <a class="el" href="struct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___d_e_c_o_d_e_d___b_u_f_f_e_r.html" title="Oscilloscope decoded data type.">SCISDK_OSCILLOSCOPE_DECODED_BUFFER</a>   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md98"></a>
Acquisition length</h2>
<p>The <code>acq_len</code> parameter is the maximum number of sample to be transferred per physical FIFO access. This parameter has an impact on the transfer speed. As bigger is the value, as faster is the transfer. Bigger value will lock the bus for a longer time and can cause a loss of data if the readout channel is shared between multiple readout block (for example multiple list or custom packet). The raccomanded value is the 90% size of the size of the internal FIFO. This parameter is expressed in packets.</p>
<h2><a class="anchor" id="autotoc_md99"></a>
Blocking/Non blocking mode</h2>
<p>In blocking mode the <code>SCISDK_ReadData</code> function will block until the buffer is full or the timeout is reached. In non-blocking mode the <code>SCISDK_ReadData</code> function will return immediately with the number of bytes read. The maximum number of bytes that can be read is the size of the buffer allocated with the function <code>SCISDK_AllocateBuffer</code>. In blocking mode the timeout is set with the <code>timeout</code> parameter. The timeout is expressed in ms. In non-blocking mode the timeout is not used. In both mode, if the buffer is fill with even just a single word the function will return NI_OK. If there is no data at all the read function will return NI_NO_DATA_AVAILABLE.</p>
<h2><a class="anchor" id="autotoc_md100"></a>
Threaded mode</h2>
<p>In threaded mode the list will start a thread that will read the data from the hardware FIFO and store it in an internal buffer (thread buffer). The <code>SCISDK_ReadData</code> function will read the data from the thread buffer. While in polling mode, if the user do not call the <code>SCISDK_ReadData</code> function, the FIFO in the FPGA can be full and the data will be lost. In threaded mode the data are stored in the thread buffer automatically. The internall thread will poll the FPGA to check if data is available and will store it in the thread buffer. Thread mode increase the perfomance of the list because, but consume continuously the communication bandiwdth between the FPGA and the PC. The user lost the control on how much time the specific list will access to the shared bus.</p>
<h2><a class="anchor" id="autotoc_md101"></a>
High performance mode</h2>
<p>We discurage to enable this parameter. If enabled, the highe performace mode force the internal physical ReadFIFO function to ignore the word available field of the FIFO. When this parameter is disable, the ReadFIFO function check the word available field of the FIFO and will make a read only if this number if not 0. More over the read size will be the minimum between word available and acq_len parameter. In this way the ReadFIFO function will not lock the bus for a long time. In high perforamnce mode, the ReadFIFO will always setup a read cycle with size equal to acq_len parameter. This will lock the bus for a long time untill all data are received. This will increase significantly the transfer speed but no other access, even to read/write register can be done until all data are received or the timeout is reached. Use this mode only if you are sure that the bus is not shared with other readout block and you don't need</p>
<h1><a class="anchor" id="autotoc_md102"></a>
Allignment check</h1>
<p>The <code>check_align_word</code> parameter can be used to check the packet alignment. If enabled, the <code>SCISDK_ReadData</code> function will check if the data are alligned to the packet. The alignament algorithm is the following:</p><ul>
<li>first check the JSON from SciCompiler if the first word in the packet definition is a constant. This will be the alignament word.</li>
<li>read a bounce of data from the FPGA fifo</li>
<li>check if the first world in the bounce is the alignament word, if not, discard data until the alignament word is found.</li>
</ul>
<p>In order to set to true the <code>check_align_word</code> parameter, the first word in the packet definition must be a constant. If the first word is a variable, the <code>check_align_word</code> parameter will be set to false and any attempt to set it to true will return NI_PARAMETER_CAN_NOT_BE_SET_WITH_THIS_CONFIG.</p>
<h1><a class="anchor" id="autotoc_md103"></a>
Data processing mode</h1>
<p>The <code>data_processing</code> parameter can be used to set the data processing mode. The data processing mode can be set to raw or decode. In raw mode the data are not processed and the user will receive the raw data from the FPGA. In decode mode the data are processed and the user will receive the data as they are pushed in the FPGA fifo, loosing the concept of packet. The custom packet behavior is the same of the list In decode mode the data are analized, divided in packet and it is possible to check the alignment to an aligment word.</p>
<h1><a class="anchor" id="autotoc_md104"></a>
Commands</h1>
<p>The following commands are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Parameter    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">start   </td><td class="markdownTableBodyNone">Clear the FIFO and start the acqusition   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">stop   </td><td class="markdownTableBodyNone">Stop the acquisition   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Start will clear the list content, create the internal thread and allocate the thread buffer if thread mode is enable and start the acquisition. All list parameter can not be changed while the acquisition is in progress. Stop the list before change any parameter or the property set will be rejected.</p>
<h1><a class="anchor" id="autotoc_md105"></a>
Buffer Allocation</h1>
<p>The buffer is allocated using the <code>SCISDK_AllocateBuffer</code> function. The buffer is freed using the <code>SCISDK_FreeBuffer</code> function. Because the List inside the Custom Packet is a FIFO is not possible to know a priori the number of bytes that will be transferred. The <code>SCISDK_AllocateBuffer</code> take indeed an extra parameter to specify the size of the buffer (in packet) on the PC side; the <code>SCISDK_ReadData</code> function will try to read the maximum number of bytes that can fit in the buffer.</p>
<p>This is an example on how allocate a Custom Packet Buffer: </p><div class="fragment"><div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(&lt;path to custom packet&gt;, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;cp_data, &lt;number of packets&gt;)</div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_ac3f231d328ae4716a3d5910e00b44d7b"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_AllocateBuffer(char *Path, T_BUFFER_TYPE buffer_type, void **buffer, void *handle)</div><div class="ttdoc">Allocate a buffer to be used to store data from the board for the specific Memory Mapped Componet (os...</div></div>
<div class="ttc" id="ascisdk__defines_8h_html_ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c"><div class="ttname"><a href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a></div><div class="ttdeci">@ T_BUFFER_TYPE_RAW</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:229</div></div>
</div><!-- fragment --><p>The buffer allocated with the <code>SCISDK_AllocateBuffer</code> function has a last size parameters containing the number of packet the user want to allocate in the buffer. For example if the user create in SciCompiler a custom packet with 5 rows (32 bit per row) and want to allocate a buffer with 1000 packets, the function will allocate a buffer with 16000 bytes. The <code>SCISDK_ReadData</code> function will try to fill the buffer with 16000 bytes (1000 words * 16 bytes) each time is called. It is crtical to ensure that the transfer will always be aligned to the word size to avoid to read partial words with irrecoverable data loss.</p>
<p>This example allocate a buffer with 1000 packet:</p>
<div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_CP_DECODED_BUFFER</a> cp_data;</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, T_BUFFER_TYPE_DECODE, (<span class="keywordtype">void</span>**)&amp;cp_data, 1000)</div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_CP_DECODED_BUFFER</a></div><div class="ttdoc">Custom Packet Decoded data structure.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:187</div></div>
</div><!-- fragment --><p>It is also possible to allocate RAW buffer, in that case the size of packet is fixed to 1 row (1DWORD), the buffer size fo 1000 packets will be 4000 bytes, indipendently from the number of rows in the custom packet.</p>
<div class="fragment"><div class="line"> <a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html">SCISDK_CP_RAW_BUFFER</a> cp_data;</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;cp_data, 1000)</div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html">SCISDK_CP_RAW_BUFFER</a></div><div class="ttdoc">Custom Packet Raw data structure.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:204</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md106"></a>
Output data Format</h1>
<h2><a class="anchor" id="autotoc_md107"></a>
Raw Data</h2>
<p>The data output structure is the following: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint32_t magic;             </div>
<div class="line">    uint32_t *data;             </div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        uint32_t buffer_size;   </div>
<div class="line">        uint32_t valid_data;    </div>
<div class="line">    } info;</div>
<div class="line">}<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html">SCISDK_CP_RAW_BUFFER</a>;</div>
</div><!-- fragment --><p> <code>magic</code> : magic number to identify the buffer type. It is set to SCISDK_CP_RAW_BUFFER_MAGIC <code>data</code> : it's the array of the raw data. The data is stored as a uint32_t array. No further details on data decode is provided for raw mode. Raw mode is provided for post processing porpouse of the data. is just usefull to read data in a buffer and store it in a file. The decode should be done in post processing.</p>
<h2><a class="anchor" id="autotoc_md108"></a>
Decoded Data</h2>
<p>The data output structure is the following: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint32_t magic;                 </div>
<div class="line">    <a class="code" href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html">SCISDK_CP_PACKET</a> *data;         </div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        uint32_t buffer_size;       </div>
<div class="line">        uint32_t packet_size;       </div>
<div class="line">        uint32_t valid_data;        </div>
<div class="line">    } info;</div>
<div class="line">}<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_CP_DECODED_BUFFER</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint32_t *row;          </div>
<div class="line">    uint32_t n;         </div>
<div class="line">}<a class="code" href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html">SCISDK_CP_PACKET</a>;</div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___p_a_c_k_e_t_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html">SCISDK_CP_PACKET</a></div><div class="ttdoc">Custom Packet body decoded data.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:177</div></div>
</div><!-- fragment --><p><code>magic</code> : magic number to identify the buffer type. It is set to SCISDK_CP_DECODED_BUFFER_MAGIC <code>data</code> : it's the array of the decoded data. The data is stored as a <a class="el" href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html" title="Custom Packet body decoded data.">SCISDK_CP_PACKET</a> array. <code>buffer_size</code> : the number of packet that can fit in the buffer <code>packet_size</code> : the number of row in the packet <code>valid_data</code> : the number of valid packet in the buffer</p>
<p>The <a class="el" href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html" title="Custom Packet body decoded data.">SCISDK_CP_PACKET</a> rappresent the single data packet. It is composed by an array of row and the number of row in the packet. <code>row</code> : it's the array of the decoded data. The data is stored as a uint32_t array. <code>n</code> : it's the number of row in the packet. In the actual implementation the number of row in the packet is always the same for all the packet in the buffer and is equal to <code>packet_size</code>.</p>
<p>If the inputs of the custom packet are all aligned to 32bit the decode of the data is very simple. Just read the data in the struct, from first to last row and this is mapped 1:1 to the input of the custom packet.</p>
<p><img src="cp02.png" alt="" class="inline"/> <br  />
</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cp_data-&gt;info.valid_data; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ALIGN WORD 0x%08x &quot;</span>, cp_data-&gt;data[i].row[0]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN2 0x%08x &quot;</span>, cp_data-&gt;data[i].row[1]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN3 0x%08x &quot;</span>, cp_data-&gt;data[i].row[2]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN4 0x%08x &quot;</span>, cp_data-&gt;data[i].row[3]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN5 0x%08x &quot;</span>, cp_data-&gt;data[i].row[4]);</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p> If multiple input of the custom packet are packed in a single word, the decode of the data is more complex. The user may use shift and mast operation to access to the data</p>
<p><img src="cp03.png" alt="" class="inline"/> <br  />
</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cp_data-&gt;info.valid_data; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ALIGN WORD 0x%08x &quot;</span>, cp_data-&gt;data[i].row[0]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN2 0x%08x &quot;</span>, cp_data-&gt;data[i].row[1]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN3 0x%08x &quot;</span>, cp_data-&gt;data[i].row[2]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN4 0x%08x &quot;</span>, (cp_data-&gt;data[i].row[3] &gt;&gt; 0) &amp; 0xFFFF);</div>
<div class="line">        printf(<span class="stringliteral">&quot;IN5 0x%08x &quot;</span>, (cp_data-&gt;data[i].row[3] &gt;&gt; 16) &amp; 0xFFFF);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The is also the possibility, in some programming language to cast the packet buffer to a struct. Consider the first example, a PSD (pulse shape discrimination) that produce for each event a packet with channel identificatiom, timestamp, two charge measure (Qshort/Qlong) and four flags.:</p>
<p><img src="cp01.png" alt="" class="inline"/> <br  />
</p>
<p>We can immagine a packet struct like this:</p>
<p>ROW 0:</p><ul>
<li>32 bit word alignament fixed to 0xABBA1234 ROW 1:</li>
<li>8 bit constant value fixed to identify the type of the packet (0x01)</li>
<li>4 bit flags from IN_1:<ul>
<li>pileup</li>
<li>global_trigger_fired</li>
<li>local_trigger_fired</li>
<li>calibration</li>
</ul>
</li>
<li>12 spare bits</li>
<li>8 bit channel number from IN_2 ROW 2 and 3:</li>
<li>64 bit timestamp from IN_3 ROW 4:</li>
<li>16 bit energy (Qshort) from IN_4</li>
<li>16 bit energy (Qlong) from IN_5</li>
</ul>
<p>This example show how to cast the data to a pack struct:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><span class="preprocessor">#define PACK( __Declaration__ ) __pragma( pack(push, 1) ) __Declaration__ __pragma( pack(pop))</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define PACK( __Declaration__ ) __Declaration__ __attribute__((__packed__))</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">PACK(<span class="keyword">typedef</span> <span class="keyword">struct</span> DATA_STRUCT {</div>
<div class="line">    uint32_t align_word : 32;</div>
<div class="line">    uint8_t pk_type : 8;</div>
<div class="line">    uint8_t pileup : 1;</div>
<div class="line">    uint8_t global_trigger_fired : 1;</div>
<div class="line">    uint8_t local_trigger_fired : 1;</div>
<div class="line">    uint8_t calibration : 1;</div>
<div class="line">    uint16_t spare : 12;</div>
<div class="line">    uint8_t channel : 8;</div>
<div class="line">    uint64_t timestamp : 64;</div>
<div class="line">    uint16_t qshort : 16;</div>
<div class="line">    uint16_t qlong : 16;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">DATA_STRUCT *data = (DATA_STRUCT*)list_data-&gt;data;</div>
<div class="line">for (<span class="keywordtype">int</span> i = 0; i &lt; list_data-&gt;info.valid_samples; i++) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Timestamp %d\n&quot;</span>, data[i].timestramp);</div>
<div class="line">    printf(<span class="stringliteral">&quot;PILEUP: %d    GBL_TRG: %d    LOC_TRG: %d   CAL: %d\n&quot;</span>, </div>
<div class="line">                    data[i].pileup,</div>
<div class="line">                    data[i].global_trigger_fired,</div>
<div class="line">                    data[i].local_trigger_fired,</div>
<div class="line">                    data[i].calibration);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Qshort: %6d   Qlong: %6d\n&quot;</span>, data[i].qshort);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Qshort: %6d   Qlong: %6d\n&quot;</span>, data[i].qlong);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md109"></a>
Basic Examples</h1>
<h2><a class="anchor" id="autotoc_md110"></a>
C</h2>
<p><b>Simple example with raw data</b> </p><div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html">SCISDK_CP_RAW_BUFFER</a> *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>), <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 1024);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;raw&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.timeout&quot;</span>, 5000, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk); </div>
<div class="line">        </div>
<div class="line"><span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Read %d DWORD from packet buffer:\n&quot;</span>, lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#ab5f862251789882352b59b934c382047">info</a>.<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#a3857147aa15bbb96fe35440810a4edb3">valid_data</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#ab5f862251789882352b59b934c382047">info</a>.<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#a3857147aa15bbb96fe35440810a4edb3">valid_data</a>; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;0x%08x &quot;</span>, lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#a59e214c517066c7de02773c1fc57b338">data</a>[i]);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    </div>
<div class="line">}</div>
<div class="ttc" id="a_n_i_error_code_8h_html_ae749d3c5e8d435a8bc05e47792d996d8"><div class="ttname"><a href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a></div><div class="ttdeci">#define NI_OK</div><div class="ttdef"><b>Definition:</b> NIErrorCode.h:8</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a00407547516aa0d9a26f273423366be3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterString(char *Path, char *value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a0f722da8b5e19540555298e0806bb45f"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterInteger(char *Path, int value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a16a7364c71d331be2da443c61f7a25f3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ExecuteCommand(char *Path, char *value, void *handle)</div><div class="ttdoc">Execute a command for the specific Memory Mapped Component device driver/endpoint....</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a612babf059fa19eaac91fae6da160f85"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_AllocateBufferSize(char *Path, T_BUFFER_TYPE buffer_type, void **buffer, void *handle, int size)</div><div class="ttdoc">Allocate a buffer to be used to store data from the board for the specific Memory Mapped Componet (li...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_aeae6abf2d2a9a72799a64a3aa2d528c1"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ReadData(char *Path, void *buffer, void *handle)</div><div class="ttdoc">Read data from the board for the specific Memory Mapped Componet (oscilloscope, spectrum,...</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r_html_a3857147aa15bbb96fe35440810a4edb3"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#a3857147aa15bbb96fe35440810a4edb3">SCISDK_CP_RAW_BUFFER::valid_data</a></div><div class="ttdeci">uint32_t valid_data</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:209</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r_html_a59e214c517066c7de02773c1fc57b338"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#a59e214c517066c7de02773c1fc57b338">SCISDK_CP_RAW_BUFFER::data</a></div><div class="ttdeci">uint32_t * data</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:206</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r_html_ab5f862251789882352b59b934c382047"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#ab5f862251789882352b59b934c382047">SCISDK_CP_RAW_BUFFER::info</a></div><div class="ttdeci">struct SCISDK_CP_RAW_BUFFER::@8 info</div></div>
</div><!-- fragment --><p>Expected output will be something like this: </p><div class="fragment"><div class="line">Read 1024 DWORD from packet buffer:</div>
<div class="line">0xABBA1234</div>
<div class="line">0x01600001</div>
<div class="line">0x00000023</div>
<div class="line">0x00000123</div>
<div class="line">0x12300067</div>
<div class="line">0xABBA1234</div>
<div class="line">0x01600001</div>
<div class="line">0x00013000</div>
<div class="line">0x00000123</div>
<div class="line">0x02510168</div>
<div class="line">....</div>
</div><!-- fragment --><p><b>Simple example with decoded data</b> </p><div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_CP_DECODED_BUFFER</a> *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>), <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d">T_BUFFER_TYPE_DECODED</a>, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 1024);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;decode&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.timeout&quot;</span>, 5000, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Read %d packets from packet buffer:\n&quot;</span>, lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a02751ad2c478f72f85d35f4f3ac5d886">info</a>.<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a64133fa385dc62487a9bc11450d64ebf">valid_data</a>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a02751ad2c478f72f85d35f4f3ac5d886">info</a>.<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a64133fa385dc62487a9bc11450d64ebf">valid_data</a>; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;PACKET %d\n&quot;</span>, i);</div>
<div class="line">        <span class="keywordflow">for</span> <span class="keywordtype">int</span> j = 0; j &lt; lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a02751ad2c478f72f85d35f4f3ac5d886">info</a>.<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a8c593214f81f648a25dc30ca99741ff8">data</a>[i].<a class="code" href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html#ab277d5814562ce7353d26e11c967523d">n</a>; j++) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;        0x%08x &quot;</span>, lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a8c593214f81f648a25dc30ca99741ff8">data</a>[i].<a class="code" href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html#a49f72ef15283a65aa75779f5c2ab547e">row</a>[j]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="ascisdk__defines_8h_html_ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d"><div class="ttname"><a href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d">T_BUFFER_TYPE_DECODED</a></div><div class="ttdeci">@ T_BUFFER_TYPE_DECODED</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:230</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r_html_a02751ad2c478f72f85d35f4f3ac5d886"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a02751ad2c478f72f85d35f4f3ac5d886">SCISDK_CP_DECODED_BUFFER::info</a></div><div class="ttdeci">struct SCISDK_CP_DECODED_BUFFER::@7 info</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r_html_a64133fa385dc62487a9bc11450d64ebf"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a64133fa385dc62487a9bc11450d64ebf">SCISDK_CP_DECODED_BUFFER::valid_data</a></div><div class="ttdeci">uint32_t valid_data</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:193</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r_html_a8c593214f81f648a25dc30ca99741ff8"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html#a8c593214f81f648a25dc30ca99741ff8">SCISDK_CP_DECODED_BUFFER::data</a></div><div class="ttdeci">SCISDK_CP_PACKET * data</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:189</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___p_a_c_k_e_t_html_a49f72ef15283a65aa75779f5c2ab547e"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html#a49f72ef15283a65aa75779f5c2ab547e">SCISDK_CP_PACKET::row</a></div><div class="ttdeci">uint32_t * row</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:178</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___c_p___p_a_c_k_e_t_html_ab277d5814562ce7353d26e11c967523d"><div class="ttname"><a href="struct_s_c_i_s_d_k___c_p___p_a_c_k_e_t.html#ab277d5814562ce7353d26e11c967523d">SCISDK_CP_PACKET::n</a></div><div class="ttdeci">uint32_t n</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:179</div></div>
</div><!-- fragment --><p>Expected output will be something like this: </p><div class="fragment"><div class="line">Read 50 packets from packet buffer:</div>
<div class="line">PACKET 0</div>
<div class="line">        0xABBA1234</div>
<div class="line">        0x01600001</div>
<div class="line">        0x00000023</div>
<div class="line">        0x00000123</div>
<div class="line">        0x12300067</div>
<div class="line">PACKET 1</div>
<div class="line">        0xABBA1234</div>
<div class="line">        0x01600001</div>
<div class="line">        0x00013000</div>
<div class="line">        0x00000123</div>
<div class="line">        0x02510168</div>
<div class="line">....</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md111"></a>
C++</h2>
<div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_CP_DECODED_BUFFER</a> *lrb;</div>
<div class="line">sdk-&gt;AllocateBufferSize(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, T_BUFFER_TYPE_DECODE, (<span class="keywordtype">void</span>**)&amp;lrb, 1024);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;decode&quot;</span>);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.timeout&quot;</span>, 5000);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>);</div>
<div class="line">sdk-&gt;ExecuteCommand(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> res = sdk-&gt;ReadData(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (res != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error reading data\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md112"></a>
Python</h2>
<div class="fragment"><div class="line">res, lrb = sdk.AllocateBufferSize(&quot;board0:/MMCComponents/CP_0&quot;, 1, 1024)</div>
<div class="line"> </div>
<div class="line">if res != 0:</div>
<div class="line">    print(&quot;Error allocating buffer&quot;)</div>
<div class="line">    exit(-1)</div>
<div class="line"> </div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.thread&quot;, &quot;false&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.data_processing&quot;, &quot;decode&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.timeout&quot;, 5000)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.acq_mode&quot;, &quot;blocking&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/CP_0.start&quot;, &quot;&quot;)</div>
<div class="line"> </div>
<div class="line">res, lrb = sdk.ReadData(&quot;board0:/MMCComponents/CP_0&quot;, lrb)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md113"></a>
C Sharp</h2>
<div class="fragment"><div class="line">SCISDK_CP_DECODED_BUFFER lrb = new SCISDK_CP_DECODED_BUFFER();</div>
<div class="line">sdk.AllocateBufferSize(&quot;board0:/MMCComponents/CP_0&quot;, 1, ref lrb, 1024);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.data_processing&quot;, &quot;decode&quot;);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.thread&quot;, &quot;false&quot;);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.timeout&quot;, 5000);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.acq_mode&quot;, &quot;blocking&quot;);</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/CP_0.start&quot;, &quot;&quot;);</div>
<div class="line"> </div>
<div class="line">int res = sdk.ReadData(&quot;board0:/MMCComponents/CP_0&quot;, ref lrb);</div>
<div class="line"> </div>
<div class="line">if (res != 0) {</div>
<div class="line">    Console.WriteLine(&quot;Error reading data&quot;);</div>
<div class="line">    return -1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md114"></a>
VB.NET</h2>
<div class="fragment"><div class="line">Dim lrb As New SCISDK_CP_DECODED_BUFFER()</div>
<div class="line">sdk.AllocateBufferSize(&quot;board0:/MMCComponents/CP_0&quot;, 0, lrb, 1024)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.data_processing&quot;, &quot;decode&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.thread&quot;, &quot;false&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.timeout&quot;, 5000)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/CP_0.acq_mode&quot;, &quot;blocking&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/CP_0.start&quot;, &quot;&quot;)</div>
<div class="line"> </div>
<div class="line">Dim res As Integer = sdk.ReadData(&quot;board0:/MMCComponents/CP_0&quot;, lrb)</div>
<div class="line"> </div>
<div class="line">If res &lt;&gt; 0 Then</div>
<div class="line">    Console.WriteLine(&quot;Error reading data&quot;)</div>
<div class="line">    Return -1</div>
<div class="line">End If</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md115"></a>
JAVA</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> res = sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line">res = sdk.SetParameterInteger(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.timeout&quot;</span>, 500);</div>
<div class="line">res = sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;non-blocking&quot;</span>);</div>
<div class="line">res = sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.check_align_word&quot;</span>, <span class="stringliteral">&quot;check_align_word&quot;</span>);</div>
<div class="line">res = sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;decode&quot;</span>);</div>
<div class="line"> </div>
<div class="line">res = sdk.ExecuteCommand(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="comment">// Allocate buffer decoded, size 100</span></div>
<div class="line">Ref&lt;CPDecodedBuffer&gt; buf = <span class="keyword">new</span> Ref&lt;&gt;(<span class="keyword">new</span> CPDecodedBuffer());</div>
<div class="line">res = sdk.AllocateBuffer(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, buf, 100);</div>
<div class="line"><span class="keywordflow">if</span>(res == 0) {</div>
<div class="line">    res = sdk.ReadData(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, buf);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md116"></a>
Additional Examples</h1>
<h2><a class="anchor" id="autotoc_md117"></a>
Decode list data in C</h2>
<p>A multichannel system is used to detect neutron and gamma. Neutron has a longer dacay time and gamma has a shorter decay time. The system will use a charge integrator with two time windows to calculate Qshoe and Qlong.</p>
<p>ROW 0:</p><ul>
<li>32 bit word alignament fixed to 0xABBA1234 ROW 1:</li>
<li>8 bit constant value fixed to identify the type of the packet (0x01)</li>
<li>4 bit flags from IN_1:<ul>
<li>pileup</li>
<li>global_trigger_fired</li>
<li>local_trigger_fired</li>
<li>calibration</li>
</ul>
</li>
<li>12 spare bits</li>
<li>8 bit channel number from IN_2 ROW 2 and 3:</li>
<li>64 bit timestamp from IN_3 ROW 4:</li>
<li>16 bit energy (Qshort) from IN_4</li>
<li>16 bit energy (Qlong) from IN_5</li>
</ul>
<div class="fragment"><div class="line">PACK(<span class="keyword">typedef</span> <span class="keyword">struct</span> DATA_STRUCT {</div>
<div class="line">    uint32_t align_word : 32;</div>
<div class="line">    uint8_t pk_type : 8;</div>
<div class="line">    uint8_t pileup : 1;</div>
<div class="line">    uint8_t global_trigger_fired : 1;</div>
<div class="line">    uint8_t local_trigger_fired : 1;</div>
<div class="line">    uint8_t calibration : 1;</div>
<div class="line">    uint16_t spare : 12;</div>
<div class="line">    uint8_t channel : 8;</div>
<div class="line">    uint64_t timestamp : 64;</div>
<div class="line">    uint16_t qshort : 16;</div>
<div class="line">    uint16_t qlong : 16;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><a class="code" href="struct_s_c_i_s_d_k___c_p___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_CP_DECODED_BUFFER</a> *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>), T_BUFFER_TYPE_DECODE, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 1024);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;decode&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.timeout&quot;</span>, 5000, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk);</div>
<div class="line"><span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    DATA_STRUCT *data = (DATA_STRUCT*)list_data-&gt;data;</div>
<div class="line">    for (<span class="keywordtype">int</span> i = 0; i &lt; list_data-&gt;info.valid_samples; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Timestamp %d\n&quot;</span>, data[i].timestramp);</div>
<div class="line">        printf(<span class="stringliteral">&quot;PILEUP: %d    GBL_TRG: %d    LOC_TRG: %d   CAL: %d\n&quot;</span>, </div>
<div class="line">                        data[i].pileup,</div>
<div class="line">                        data[i].global_trigger_fired,</div>
<div class="line">                        data[i].local_trigger_fired,</div>
<div class="line">                        data[i].calibration);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Qshort: %6d   Qlong: %6d\n&quot;</span>, data[i].qshort);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Qshort: %6d   Qlong: %6d\n&quot;</span>, data[i].qlong);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md118"></a>
Use non-blocking mode in C</h2>
<div class="fragment"><div class="line">SCISDK_CP_DECODE_BUFFER *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>), 1, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 100);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;decode&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;non-blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (1) {</div>
<div class="line">    ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk);</div>
<div class="line">    <span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Read %d packets\n&quot;</span>, lrb-&gt;info.valid_samples);</div>
<div class="line">        <span class="comment">//process data</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ab44d3b4fb5f18b8063b2e8e7299096f9">NI_TIMEOUT</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Timeout\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae09d585b8f09078008dab96dd03ea905">NI_NO_DATA_AVAILABLE</a>) {</div>
<div class="line">            <span class="comment">// Do nothing, no data available</span></div>
<div class="line">            <span class="comment">// in case manage here a timeout</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Error reading data: %d\n&quot;</span>, res);</div>
<div class="line">            <a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac9e9b4e1a5d91597095829bd13eafa30">SCISDK_s_error</a>(res, &amp;res, _sdk);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="a_n_i_error_code_8h_html_ab44d3b4fb5f18b8063b2e8e7299096f9"><div class="ttname"><a href="_n_i_error_code_8h.html#ab44d3b4fb5f18b8063b2e8e7299096f9">NI_TIMEOUT</a></div><div class="ttdeci">#define NI_TIMEOUT</div><div class="ttdef"><b>Definition:</b> NIErrorCode.h:40</div></div>
<div class="ttc" id="a_n_i_error_code_8h_html_ae09d585b8f09078008dab96dd03ea905"><div class="ttname"><a href="_n_i_error_code_8h.html#ae09d585b8f09078008dab96dd03ea905">NI_NO_DATA_AVAILABLE</a></div><div class="ttdeci">#define NI_NO_DATA_AVAILABLE</div><div class="ttdef"><b>Definition:</b> NIErrorCode.h:14</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_ac9e9b4e1a5d91597095829bd13eafa30"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#ac9e9b4e1a5d91597095829bd13eafa30">SCISDK_s_error</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_s_error(int err_no, char **value, void *handle)</div><div class="ttdoc">Convert the returned error code in a human readable string explaining the error.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md119"></a>
Dump raw data in C and than open it in python and decode it</h2>
<p>In this example we will dump the raw data in a binary file and then we will open it in python and decode it. We assume that the data packet is the following:</p><ul>
<li>32 bit word alignament fixed to 0xABBA1234</li>
<li>32 bit timestamp</li>
<li>32 bit fine timestamp with 1 ps resolution</li>
<li>16 bit Qshort</li>
<li>16 bit Qlong</li>
</ul>
<p><img src="cp03.png" alt="" class="inline"/> <br  />
</p>
<div class="fragment"><div class="line"><span class="comment">//open file</span></div>
<div class="line">FILE *fp = fopen(<span class="stringliteral">&quot;data.bin&quot;</span>, <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error opening file\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//configure CP</span></div>
<div class="line"><a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html">SCISDK_CP_RAW_BUFFER</a> *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>), <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 1024);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.data_processing&quot;</span>, <span class="stringliteral">&quot;raw&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.timeout&quot;</span>, 5000, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(1) {</div>
<div class="line">    ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/CP_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">        fwrite(lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#a59e214c517066c7de02773c1fc57b338">data</a>, 1, lrb-&gt;<a class="code" href="struct_s_c_i_s_d_k___c_p___r_a_w___b_u_f_f_e_r.html#ab5f862251789882352b59b934c382047">info</a>.valid_samples * 4, fp);  </div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">fclose(fp);</div>
</div><!-- fragment --><p>Now we can open the file in python and decode it:</p>
<div class="fragment"><div class="line">import struct</div>
<div class="line"> </div>
<div class="line">with open(&quot;data.bin&quot;, &quot;rb&quot;) as f:</div>
<div class="line">    while True:</div>
<div class="line">        data = f.read(4)</div>
<div class="line">        if not data:</div>
<div class="line">            break</div>
<div class="line">        align = struct.unpack(&quot;&lt;I&quot;, data)[0]</div>
<div class="line">        if align != 0xABBA1234:</div>
<div class="line">            print(&quot;Error alignament&quot;)</div>
<div class="line">            break</div>
<div class="line">        data = f.read(4)</div>
<div class="line">        timestamp = struct.unpack(&quot;&lt;I&quot;, data)[0]</div>
<div class="line">        data = f.read(4)</div>
<div class="line">        fine_timestamp = struct.unpack(&quot;&lt;I&quot;, data)[0]</div>
<div class="line">        data = f.read(4)</div>
<div class="line">        qshort = struct.unpack(&quot;&lt;H&quot;, data)[0]</div>
<div class="line">        data = f.read(4)</div>
<div class="line">        qlong = struct.unpack(&quot;&lt;H&quot;, data)[0]</div>
<div class="line">        print(&quot;Timestamp: %d  Fine timestamp: %d  Qshort: %d  Qlong: %d&quot; % (timestamp, fine_timestamp, qshort, qlong))</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
