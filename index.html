<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>SciSDK Library: SciSDK Library Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/NuclearInstruments/SCISDK" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sci-compiler-logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SciSDK Library
   </div>
   <div id="projectbrief">SDK for SciCompiler projects</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SciSDK Library Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_README"></a><b> The Software Development kit for SciCompiler User Firmware </b></p>
<h1><a class="anchor" id="autotoc_md1"></a>
1. Introduction</h1>
<p>The SciSDK is a cross-platform library to write custom control and readout software for SciCompiler generated user firmware.</p>
<p>SciCompiler is a Nuclear Instruments (<a href="http://www.nuclearinstruments.eu">http://www.nuclearinstruments.eu</a>) tool to generate FPGA firmware con NI/Caen OpenHardware FPGA (<a href="https://www.caen.it/families/open-fpga-digitizers/">https://www.caen.it/families/open-fpga-digitizers/</a>)</p>
<p>The SciCompiler convert a block diagram description of the user firmware is a hardware compatible bitstream managing also the readout of the data from the hardware. This library is intended to be used to write the control and readout software for the user firmware and works only with firmware generated by SciCompiler.</p>
<p>Several processing block of SciCompiler does not require any software support. Typically they are the algorithm processing blocks. Other components require to be configured. For example the trigger requires a configurable threshold to adopt the trigger level to the signal, indeed software configurable parameters are required. Other elemets in the diagram, like lists, oscilloscopes, digitizers, histograms produce as output a stream of value rappresenting the result of the measurament indeed they require to be readout.</p>
<p>Scicompiler implements for every readout/processing board a custom I/O bus (readout bus) to set paramenters and perform readout of the data. On one side of the bus are connected all the elements mapped in memory space like registers, oscilloscope, lists, etc...; on the other side, the bus is connected to an interface to the world external to the board like the readout workstation. The physical interface used for the transport of the data it's completely transparent to the user, it can be a network interface, a USB port, an optical link etc... The SciSDK library provides a set of functions to perform the readout of the data from the board and to set the parameters of the processing blocks that are completely indipendent from the physical interface used.</p>
<p>The SciCompiler generate a JSON file that describe the user firmware. The SciSDK library uses this file to detect each Memory Mapped Component (MMC), i.e: registers, oscilloscope, list present in the firmware and use this information perform the readout of the data and to set the parameters of the processing blocks. The JSON file include, for each element, the address of the element in the memory space, the size of the element, the type of the element, the name of the element, the configuration registers addresses and the actual configuration used to build the MMC component (i.e: for the oscilloscope the number of samples). In order to connect a board to the library the user has to provide the JSON file (generated by SciCompiler) and the connection string of the board. The JSON is a full description of the firmware and any further information is not required to the library to readout and configure the elements in the board. Read more on <a class="el" href="md_docs_mmc.html">SciCompiler local bus and SciCompiler generated firmware description JSON file </a></p>
<h1><a class="anchor" id="autotoc_md2"></a>
2. SciSDK vs Legacy SDK</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
2.1. Legacy SDK</h2>
<p>SciCompiler generate readout libraries for the custom firmware starting from the first version of the software. Up to the version 2022.10.0.3 the library was named Legacy SDK. The Legacy SDK is still supported and maintained but the SciSDK is the new library to use for the new firmware generated by SciCompiler. The main difference between the two libraries (SciSDK and Legacy SDK) is the way the library is generated. The Legacy SDK does not use the JSON file to decode the firmware structure. The library was generated by SciCompiler during the compiling process (Generate SDK phase) and all elements of the library were taylored on the firmware structure. For example, if the firmware contain three oscilloscope and one list, the library will contain three functions to readout the oscilloscopes and one function to readout the list. The three oscilloscope functions had three different names (OSCILLOSCOPE_0_ReadData, OSCILLOSCOPE_1_ReadData, OSCILLOSCOPE_2_ReadData) and the list function had a different name (LIST_0_ReadData). The C code generated for each function was different, in function of the configuration of each element. For example if one oscilloscope has 1024 and the others 2048 samples, the function to readout the oscilloscope with 1024 samples will be different from the function to readout the oscilloscope with 2048 samples, because the number of samples is embedded in the C code of the library as well as the base address of the each element. This approach has the advantage to work very well with IntelliSense and all code editor that can parse the C code and provide code completion and syntax highlighting. The disadvantage is that the library must be regenerated every time the firmware is changed. If the user edit the library, he will need to backup the modifications and manually merge the new code and the older one. Sometimes the user must edit the autogenerate code, for example with custom packet where the decode function require to be customized More over, because all elements has a different name is not possible to cycle on the elements of the firmware to readout the data or to configure the elements. This appoach is not very flexible and make the library not very easy to use on large projects with hundreds of elements to be configured and readout. So in the end the Legacy Library has a several function for each element of the firmware: at least there were one function to readout the data and a function to configure each parameter of the MMC element.</p>
<p>For example for the oscilloscope the library has the following functions:</p>
<div class="fragment"><div class="line">SCILIB <span class="keywordtype">int</span> OSCILLOSCOPE_Oscilloscope_0_START(NI_HANDLE *handle);</div>
<div class="line"> </div>
<div class="line">SCILIB <span class="keywordtype">int</span> OSCILLOSCOPE_Oscilloscope_0_SET_PARAMETERS(int32_t decimator, int32_t pre, int32_t software_trigger, int32_t analog_trigger, int32_t digital0_trigger, int32_t digital1_trigger, int32_t digital2_trigger, int32_t digital3_trigger, int32_t trigger_channel, int32_t trigger_edge, int32_t trigger_level, NI_HANDLE *handle);</div>
<div class="line"> </div>
<div class="line">SCILIB <span class="keywordtype">int</span> OSCILLOSCOPE_Oscilloscope_0_STATUS(uint32_t *status,NI_HANDLE *handle);</div>
<div class="line"> </div>
<div class="line">SCILIB <span class="keywordtype">int</span> OSCILLOSCOPE_Oscilloscope_0_POSITION(int32_t *position,NI_HANDLE *handle);</div>
<div class="line"> </div>
<div class="line">SCILIB <span class="keywordtype">int</span> OSCILLOSCOPE_Oscilloscope_0_DOWNLOAD(uint32_t *val, uint32_t size, int32_t timeout, NI_HANDLE *handle, uint32_t *read_data, uint32_t *valid_data);</div>
<div class="line"> </div>
<div class="line">SCILIB <span class="keywordtype">int</span> OSCILLOSCOPE_Oscilloscope_0_RECONSTRUCT(uint32_t *data_osc, uint32_t position, int32_t pre_trigger, uint32_t *read_analog, uint32_t *read_digital0, uint32_t *read_digital1, uint32_t *read_digital2, uint32_t *read_digital3);</div>
</div><!-- fragment --><p>The download of the data was always in raw and the user has to reconstruct the data from the raw data. The reconstruct function was generated by SciCompiler but the user must call the _STATUS, _POSITION, _DOWNLOAD and _RECOSTRUCT functions in the right order to readout the data. The user must also know how to correct allocate the buffers because the size of the buffers is not known in advance.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
2.2. SciSDK</h2>
<p>The approch with the new SciSDK is completely different. We decided to minimize the number of function and demands to the JSON file the description of the firmware structure. The library is no more generated at runtime but it's a library that we provide ready-to-use and indipendend by the firmware. The library can be installed in the system using the setup provided in the release section on github or downloading from <a href="www.caen.it">CAEN website</a> and installing the SDK. See SciSDK installation for more information. The library can also be compiled in Windows or Linux to generate a dynamic or a static library that can be linked to the user application. See compile SciSDK for more information. Each element in the SciCompiler project is described in the Firmware JSON file. When the library connect a new board, it requires a connection string and the JSON file. The library will parse the JSON file and will create a list of all elements present in the firmware. Multiple etherogenous board can be connected to the same application. The library will create a list of all elements present in the firmware of each board and will create a unique list of all elements present in all the connected boards. Each element (oscilloscope, list, etc) will have a unique path in the list of all elements. To access to any of the parameters of a component or perform the readout the full path of the elements is required to be known</p>
<p><b>The Path to the element </b></p>
<p>The path of each element is composed by the following elements</p>
<ul>
<li>the name of the board</li>
<li>the root element type (MMC, register, boardapi)</li>
<li>the path of the element in the hierarchical, starting from the top page in the desing</li>
<li>The name of the element as it is specified in MMC Name in SciCompiler design</li>
</ul>
<div class="fragment"><div class="line">&lt;board name&gt;:/&lt;root type&gt;/&lt;hierarchical path&gt;/&lt;MMC Name&gt; </div>
</div><!-- fragment --><p>The element if the firmware are divided in three root types:</p><ul>
<li>MMC elements (/MMCComponents): oscilloscope, list, spectrum, frame, etc..</li>
<li>Registers (/Registers): registers (just simple registers, not the MMC registers like the register file or the multi-channel register)</li>
<li>Board API (/boardapi): functions to configure the board (board specific parameters like offset, gains, shaper), to readout board specific endpoint (open_scope/open_dpp on caen V/DT274X), to readout information from the board like the temperature, the firmware version, etc..</li>
</ul>
<p>For example the Oscilloscope0 of the board0 will have the following path for the ReadData endpoint: </p><div class="fragment"><div class="line">board0:/MMCComponents/Oscilloscope0 </div>
</div><!-- fragment --><p>The trigger level parameter will have the following path </p><div class="fragment"><div class="line">board0:/MMCComponents/Oscilloscope0.trigger_level</div>
</div><!-- fragment --><p>The register thredhold in the top page of the design will have the following path </p><div class="fragment"><div class="line">board0:/Registers/threshold</div>
</div><!-- fragment --><p> while the register threshold in the page "page1" will have the following path </p><div class="fragment"><div class="line">board0:/Registers/page1/threshold</div>
</div><!-- fragment --><p><b>The SciSDK Function Set </b></p>
<p>The SciSDK library has a set of function to readout and configure parameters. We decided to keep limited the number of function in order to siplify the use of the library. The library has the following function set:</p>
<ul>
<li>Connect to a board</li>
<li>Set/Get Parameters</li>
<li>Ececute commands</li>
<li>Set/Get registers</li>
</ul>
<p>With this very limited number of function is possible to perform all operations. The section Usage of this document will show how to use the library to perform all operations.</p>
<p>A detailed list with function description can be found in the <a class="el" href="_sci_s_d_k___d_l_l_8h.html">src/SciSDK_DLL.h</a></p>
<h1><a class="anchor" id="autotoc_md5"></a>
3. SciSDK Structure</h1>
<p>The SciSDK is capable to connect to several different devices each one has an indipendent readout library. The SciSDK is a wrapper of the board specific readout library. For example:</p><ul>
<li>the V/DT274X has a readout library called FELib</li>
<li>the DT1260 has a readout library called SciDKSDK</li>
<li>the DT555XX family has a readout library called NiUSB30</li>
<li>the R/DT5560X family has a readout library called R5560SDK</li>
</ul>
<p>Each of these library is itself an SDK for the specific board. They have different functions to access to register, read/write memory, read/write fifo. The SciSDK wrapper all board specific functions and make a common interface to access to the hardware. This allows to connect to different boards at the same time with the same application and with just one library and to use the same function to access to the hardware.</p>
<p>The SciSDK is not just a wrapper for the underlining board specific library. It also has a set of function to readout and configure memory mapped component generated by SciCompiler. The SciSDK include drivers for all memory mapped components generated by the SciCompiler. The driver makes trasparent easy to the user the access to the component to configure and readout the data. The user does not need to know how to access to the hardware to readout the data. The user just need to know the path of the element and the properties of the element to be configured.</p>
<p>The following example shows how to readout the data from the oscilloscope of the board0.</p>
<div class="fragment"><div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0.trigger_mode&quot;</span>, <span class="stringliteral">&quot;self&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0.pretrigger&quot;</span>, 150, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0.decimator&quot;</span>, 0, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0.data_processing&quot;</span>, <span class="stringliteral">&quot;decode&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="struct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_OSCILLOSCOPE_DECODED_BUFFER</a> *ob;</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0&quot;</span>, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d">T_BUFFER_TYPE_DECODED</a>, (<span class="keywordtype">void</span>**)&amp;ob, _sdk);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0&quot;</span>, (<span class="keywordtype">void</span> *)ob, _sdk);</div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a00407547516aa0d9a26f273423366be3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterString(char *Path, char *value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a0f722da8b5e19540555298e0806bb45f"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterInteger(char *Path, int value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_ac3f231d328ae4716a3d5910e00b44d7b"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_AllocateBuffer(char *Path, T_BUFFER_TYPE buffer_type, void **buffer, void *handle)</div><div class="ttdoc">Allocate a buffer to be used to store data from the board for the specific Memory Mapped Componet (os...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_aeae6abf2d2a9a72799a64a3aa2d528c1"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ReadData(char *Path, void *buffer, void *handle)</div><div class="ttdoc">Read data from the board for the specific Memory Mapped Componet (oscilloscope, spectrum,...</div></div>
<div class="ttc" id="ascisdk__defines_8h_html_ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d"><div class="ttname"><a href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d">T_BUFFER_TYPE_DECODED</a></div><div class="ttdeci">@ T_BUFFER_TYPE_DECODED</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:230</div></div>
<div class="ttc" id="astruct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___d_e_c_o_d_e_d___b_u_f_f_e_r_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_OSCILLOSCOPE_DECODED_BUFFER</a></div><div class="ttdoc">Oscilloscope decoded data type.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:20</div></div>
</div><!-- fragment --><p> <em> The code above configure the oscilloscope in self trigger mode, set the pregtrigger to 150 samples, disable the decimator on X axe, enable the internal library data decoder and set the acquisition mode to blocking (in means that the library wait for a waveform up to the timeout). All the parameter of the oscilloscope are descibed in the <a class="el" href="md_docs_oscilloscope.html">oscilloscope driver documentation</a> Than the library allocate the correct buffer to readout the data. The buffer is allocated using the function SCISDK_AllocateBuffer. The function takes the path of the element and the type of the buffer to allocate (RAW/Decoded). The function use the information in the firmware JSON file to allocate the correct buffer. In the end the library readout the data from the oscilloscope using the function SCISDK_ReadData. The function takes the path of the element and the pointer to the buffer (pre-allocated with SCISDK_AllocateBuffer ) where to store the data. Because the oscilloscope is in blocking mode the function will wait for a waveform up to the timeout. If the timeout is reached the function will return an error (NI_NO_DATA_AVAILABLE). <em></em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md6"></a>
File structure</h2>
<p><em><em>SciSDK dymanically load the SDK of each specific board. The SDK is a shared library (.so) or a dynamic library (.dll) that is loaded at runtime. It is important to note that the SciSDK needs the specific SDK .so or .dll to be in the same folder of the SciSDK or installed in the system path.</em></em></p>
<p><em><em>If the library is installed using the installer the SDK and all board specific library are installed in the system folder and in the bin folder of the installation path (See windows and linux installation section) When the libraries are in the system path the SciSDK will automatically load without needing to copy libraries in the executable folder, it the SciSDK is not installed in the system path the library must be copied in the executable folder as well as all the board specific libraries.</em></em></p>
<p><em><em>This is the file structure of the SciSDK</em></em></p>
<p><em><em>WINODOWS </p><div class="fragment"><div class="line">SciSDK_DLL.dll</div>
<div class="line">|---&gt; SCIDK_Lib.dll                 (optional, library required for DT1260/SCIDK)</div>
<div class="line">|---&gt; CAEN_FELib.dll                (optional, library required for  V/DT274X/FELib)</div>
<div class="line">|---&gt; CAEN_Dig2Lib.dl               (optional, library required for  V/DT274X/FELib)</div>
<div class="line">|---&gt; R5560_SDKLib.dll              (optional, library required for  R5560/R5560SE/DT5560)</div>
<div class="line">|---&gt; NiUSB30.dll                   (optional, library required for  DT5550/DT5550W)</div>
<div class="line">|---&gt; libzmq-v140-mt-4_3_4.dll      (optional, service library required for R5560/R5560SE/DT5560)</div>
<div class="line">|---&gt; libsodium.dll                 (optional, service library required for R5560/R5560SE/DT5560)</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em>When installed in windows these files are copied in c:\openhardware\SciSDK\bin, and both x64 and x86 as well as release and debug version are installed. More over the installer copy these files in the system path (c:\windows\system32) and in the system path (c:\windows\sysWOW64) for x64 and x86 version respectively.</em></em></p>
<p><em><em>LINUX </p><div class="fragment"><div class="line">libscisdk.so </div>
<div class="line">|---&gt; libscidk.so                   (optional, library required for DT1260/SCIDK)</div>
<div class="line">|---&gt; libCAEN_FELib.so              (optional, library required for  V/DT274X/FELib)</div>
<div class="line">|---&gt; libCAEN_Dig2Lib.so            (optional, library required for  V/DT274X/FELib)</div>
<div class="line">|---&gt; libr5560.so                   (optional, library required for  R5560/R5560SE/DT5560)</div>
<div class="line">|---&gt; libniusb30.so                 (optional, library required for  DT5550/DT5550W)</div>
</div><!-- fragment --><p> in Linux it in necessary to install zmq and sodium library</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">sudo apt-get install libzmq3-dev libsodium-dev</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em>When installed in linux these files are copied in /usr/local/lib and the installer select the x64 or x86 version depending on the architecture of the system.</em></em></p>
<p><em><em></em></em></p>
<h1><a class="anchor" id="autotoc_md7"></a>
4. Windows: Installation from binary package</h1>
<p><em><em> Check the <a href="https://github.com/NuclearInstruments/SCISDK/releases">release page</a> for the latest version of the library. Execute the installer as administrator and follow the instruction.</em></em></p>
<p><em><em>At the end of the installation the library will be installed in the system path (c:\windows\system32) and in the system path (c:\windows\sysWOW64) for x64 and x86 version respectively. You will also find:</p><ul>
<li>the library in the installation folder (c:\openhardware\SciSDK\bin)</li>
<li>the headers (c:\openhardware\SciSDK\src)</li>
<li>the documentation (c:\openhardware\SciSDK\docs)</li>
<li>the examples for all the supported ip for several programming languages (c:\openhardware\SciSDK\examples).</li>
</ul>
<p></em></em></p>
<p><em><em></em></em></p>
<h1><a class="anchor" id="autotoc_md8"></a>
5. Linux: Installation from binary package</h1>
<p><em><em> </em></em></p>
<h1><a class="anchor" id="autotoc_md9"></a>
6. Compiling from source</h1>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md10"></a>
6.1. Compiling for Windows</h2>
<p><em><em> In order to compile the library from source you need to install Visual Studio 2022 with C++ support. Clone this repository and open the solution file (SciSDK_VC++/SciSDK.sln) in Visual Studio. From build menu select batch build and select the configuration you want to build (x64/Release or x64/Debug), or just right click on the project and select build. The output will be in the folder bin/&lt;arch&gt;/&lt;configuration&gt; (e.g. bin/x64/Release).</em></em></p>
<p><em><em>Please note that this repository just compile the SciSDK_DLL.dll. In order to compile the board specific library you need to clone the specific repository and compile the library. The list of the repository is the following:</p><ul>
<li><a href="https://github.com/NuclearInstruments/SciDK-WIN">SCIDK</a></li>
<li><a href="https://github.com/NuclearInstruments/r5560_sdk">R5560/R5560SE/DT5560</a></li>
<li><a href="https://github.com/NuclearInstruments/DT5550Wgcc">DT5550/DT5550W</a></li>
<li><a href="https://www.caen.it/products/caen-felib-library/">V/DT274X/FELib</a></li>
</ul>
<p></em></em></p>
<p><em><em>Each one contains the detailed instruction to compile the library.</em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md11"></a>
6.2. Compiling for Linux</h2>
<p><em><em> This library uses autotools. The tool will generate both the static (.a) and the shared library (.so)</em></em></p>
<p><em><em>In order to install autoconf</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install autoconf</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em>We strogly suggest to compile the library in the linuxbuild folder in order to do not generate output file in the main folder</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">autoconf</div>
<div class="line">mkdir -p linuxbuild</div>
<div class="line">cd linuxbuild</div>
<div class="line">../configure</div>
<div class="line">make</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em>In order to install the library in the os default library folder</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">make install</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em><b>Compile library to a target directory</b> It is also possible to compile the library and install them in a local folder</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">mkdir -p linuxbuild</div>
<div class="line">cd linuxbuild</div>
<div class="line">mkdir -p output</div>
<div class="line">../configure --prefix=$(pwd)/output</div>
<div class="line">make</div>
<div class="line">make install</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em>Please note that this repository just compile the SciSDK_DLL.dll. In order to compile the board specific library you need to clone the specific repository and compile the library. The list of the repository is the following:</p><ul>
<li><a href="https://github.com/NuclearInstruments/SciDK-WIN">SCIDK</a></li>
<li><a href="https://github.com/NuclearInstruments/r5560_sdk">R5560/R5560SE/DT5560</a></li>
<li><a href="https://github.com/NuclearInstruments/DT5550Wgcc">DT5550/DT5550W</a></li>
<li><a href="https://www.caen.it/products/caen-felib-library/">V/DT274X/FELib</a></li>
</ul>
<p></em></em></p>
<p><em><em>Each one contains the detailed instruction to compile the library.</em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md12"></a>
6.3. Compiling on Raspberry Pi</h2>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md13"></a>
6.4. Cross-compiling for arm, aaarch64</h2>
<p><em><em> </em></em></p>
<h1><a class="anchor" id="autotoc_md14"></a>
7. Usage</h1>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md15"></a>
7.1. Create a VS2022 project linking to the library</h2>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md16"></a>
7.2. Create a g++ project linking to the library</h2>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md17"></a>
7.3. Instantiate the library</h2>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md18"></a>
7.4. Connecting to a board</h2>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md19"></a>
7.5. Set/Get a register value</h2>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md20"></a>
7.6. Allocate buffers for readout</h2>
<p><em><em> </em></em></p>
<h2><a class="anchor" id="autotoc_md21"></a>
7.7. Readout data from a board</h2>
<p><em><em> </em></em></p>
<h1><a class="anchor" id="autotoc_md22"></a>
8 Use with Java</h1>
<p><em><em>SciSDK can be used in Java with a <a href="https://github.com/NuclearInstruments/SCISDK/tree/master/wrapper/JSciSDK/JSciSDK">wrapper</a>.</em></em></p>
<p><em><em>To use this wrapper library you must have SciSDK installed on your computer.</em></em></p>
<p><em><em>SciSDK java wrapper can be included in projects that use different build tools, here is explained how to include JSciSDK in Ant and Maven managed projects: </em></em></p>
<h2><a class="anchor" id="autotoc_md23"></a>
8.1 Include in an Ant managed project</h2>
<p><em><em>To use SciSDK in an Ant managed java project you need to:</p><ul>
<li>Download latest version on SciSDK java library's .jar file</li>
<li>Download JNA (Java Native Access) library's .jar file from the <a href="https://github.com/java-native-access/jna">official github repository</a>. JNA is used to access SciSDK's native DLL.</li>
<li>Include both libraries's jar files in your project</li>
</ul>
<p></em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md24"></a>
8.2 Include in a Maven managed project</h2>
<p><em><em>To use SciSDK in a Maven managed java project you need to:</p><ul>
<li>Copy dependency xml formatted string of the latest version of SciSDK java wrapper from <a href="https://mvnrepository.com/artifact/io.github.NuclearInstruments/JSciSDK">Maven Central Repository</a>, for example for library version 1.1 will be: <div class="fragment"><div class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.github.NuclearInstruments/JSciSDK --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">dependency</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">groupId</span>&gt;<span class="keyword">io.github.NuclearInstruments</span>&lt;/<span class="keywordtype">groupId</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">artifactId</span>&gt;<span class="keyword">JSciSDK</span>&lt;/<span class="keywordtype">artifactId</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">version</span>&gt;1.1&lt;/<span class="keywordtype">version</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">dependency</span>&gt;</div>
</div><!-- fragment --></li>
<li>Paste it into dependencies section of pom.xml file of your project</li>
</ul>
<p></em></em></p>
<p><em><em>In a Maven managed project you don't need to include JNA dependency like in a Java with Ant project because it will be automatically included as dependency of SciSDK java wrapper.</em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md25"></a>
8.3. Instantiate the library</h2>
<p><em><em>To initialize the library use the default SciSDK constructor: </p><div class="fragment"><div class="line">SciSDK sdk = <span class="keyword">new</span> SciSDK();</div>
</div><!-- fragment --><p> This constructor creates a pointer to the SciSDK native code object instance so when you no longer need to use the SciSDK in your program (for example before the end of the program) free up memory with:</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">sdk.FreeLib();</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md26"></a>
8.4 Connecting to a board</h2>
<p><em><em>The following example explains how to connect to a dt1260 board.</em></em></p>
<p><em><em></p><div class="fragment"><div class="line">SciSDK sdk = <span class="keyword">new</span> SciSDK();</div>
<div class="line"><span class="keywordtype">int</span> res = sdk.AddNewDevice(<span class="stringliteral">&quot;usb:28645&quot;</span>, <span class="stringliteral">&quot;dt1260&quot;</span>, <span class="stringliteral">&quot;./DT1260RegisterFile.json&quot;</span>, <span class="stringliteral">&quot;board0&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(res != 0) {</div>
<div class="line">    System.out.println(<span class="stringliteral">&quot;Program exit due to connection error&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// print error description</span></div>
<div class="line">    Ref&lt;String&gt; error_description = <span class="keyword">new</span> Ref&lt;&gt;(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    sdk.s_error(res, error_description);</div>
<div class="line">    System.out.println(<span class="stringliteral">&quot;ERROR DESCRIPTION: &quot;</span> + error_description.get());</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// detach board</span></div>
<div class="line">sdk.DetachDevice(<span class="stringliteral">&quot;board0&quot;</span>);</div>
<div class="line">sdk.FreeLib();</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md27"></a>
8.5 Set/Get a register value</h2>
<p><em><em>The following example explains how to set the value of a register: </p><div class="fragment"><div class="line"><span class="comment">// set value of register A</span></div>
<div class="line">res = sdk.SetRegister(<span class="stringliteral">&quot;board0:/Registers/A&quot;</span>, 100);</div>
</div><!-- fragment --><p> The following example explains how to read the value of a register: </p><div class="fragment"><div class="line"><span class="comment">// set value of register B</span></div>
<div class="line">Ref&lt;Integer&gt; value = <span class="keyword">new</span> Ref&lt;&gt;(0);</div>
<div class="line">sdk.GetRegister(<span class="stringliteral">&quot;board0:/Registers/B&quot;</span>, value);</div>
<div class="line">System.out.println(<span class="stringliteral">&quot;Register B value is: &quot;</span> + value.get());</div>
</div><!-- fragment --><p> </em></em></p>
<h2><a class="anchor" id="autotoc_md28"></a>
8.6 Allocate buffers for readout</h2>
<p><em><em>The following example explains how to allocate buffer for readout: </p><div class="fragment"><div class="line"><span class="comment">// allocate oscilloscope buffer</span></div>
<div class="line">Ref&lt;OscilloscopeDecodedBuffer&gt; buffer = <span class="keyword">new</span> Ref&lt;&gt;(<span class="keyword">new</span> OscilloscopeDecodedBuffer());</div>
<div class="line">res = sdk.AllocateBuffer(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0&quot;</span>, buffer);</div>
</div><!-- fragment --><p></em></em></p>
<p><em><em></em></em></p>
<h2><a class="anchor" id="autotoc_md29"></a>
8.7 Readout data from a board</h2>
<p><em><em>The following example explains how to read data from the board: </p><div class="fragment"><div class="line"><span class="comment">// read oscilloscope oscilloscope data</span></div>
<div class="line">res = sdk.ReadData(<span class="stringliteral">&quot;board0:/MMCComponents/Oscilloscope_0&quot;</span>, buffer);</div>
</div><!-- fragment --><p> Buffer parameter is the buffer that has been allocated in the previous example</em></em></p>
<p><em><em>You can find more examples in each component description page and in the <a href="https://github.com/NuclearInstruments/SCISDK/tree/master/examples">examples folder</a> </em></em></p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
