<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>SciSDK Library: Time of Flight Spectrum</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/NuclearInstruments/SCISDK" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sci-compiler-logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SciSDK Library
   </div>
   <div id="projectbrief">SDK for SciCompiler projects</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_tof_spectrum.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Time of Flight Spectrum </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The time of flight spectrum is an histogram used to measure the time delay between a T0 and a trigger events. The T0 is a reference event that is used to synchronize the acquisition of the data. The trigger event is the event that is used to measure the time delay. For example the T0 can be a laser digital trigger pulse and the trigger event can be a photon detected by a PMT. The laser pulse can irragiate a biological sample and the PMT observe the photons generated by the flourescence of the sample. The time of flight spectrum is used to measure the time delay between the laser trigger and the photons arriving on the detector displaying as an histogram. In another application ToF spectrum can be used for neutron ToF Spectroscopy. In this case the T0 is for example the synchrotron kicker signal or the chopper sync pulse and the trigger event is a neutron detected by a neutron detector (ie He3 tube).</p>
<p>The ToF component in SciCompiler has indeed two input:</p><ul>
<li>T0: the reference event</li>
<li>IN: the trigger event</li>
</ul>
<p>There is a minimum delay between the T0 and the first event, this can be configured with parameter <code>start_delay</code>. Any events before this delay are discarded. The histrogram start after the start delay In any case, at least one clock cycle between T0 and first event must be present.</p>
<p><em>dead time</em>: the bin width, expressed in clock cycles, is configured with parameter <code>binwidth</code>. A bin width of 3 clock cycles must be respected to allow the internal FPGA logic to switch between each bin.</p>
<p>So the time base (x bin on the histogram) is given by the formula: binwidth * clock_period * index_of_the_bin</p>
<p>Every time a T0 is received, the ToF resets the index_of_the_bin and accumulate counts in the specific bin of the histogram. For example, if the <code>binwidth</code> is set to 10 and the clock of the board is 100 MHz, each bin will last 100ns. The T0 rising edge force the bin of the ToF to go back to 0 but it will not reset the histogram. The histogram will accumulate counts in the bin 0 from T0 to 100ns than it will pass to bin 1 from 100ns to 200ns and so on.</p>
<div class="fragment"><div class="line">0 ....... 100n ....... 200n ....... 300n</div>
<div class="line">     0            1            2</div>
<div class="line">     *</div>
<div class="line">     *                         *</div>
<div class="line">     *                         *</div>
<div class="line">     *            *            *</div>
</div><!-- fragment --><p>When a second T0 is received, the index_of_the_bin if forced back to 0 and the histogram is restart to integrate on bin 0. The histogram will accumulate counts in the bin 0 from T0 to 100ns than it will pass to bin 1 from 100ns to 200ns and so on.</p>
<div class="fragment"><div class="line">0 ....... 100n ....... 200n ....... 300n</div>
<div class="line">     0            1            2</div>
<div class="line">                  *</div>
<div class="line">                  *</div>
<div class="line">     *            *</div>
<div class="line">     *            *</div>
<div class="line">     *            *            *</div>
<div class="line">     *            *            *</div>
<div class="line">     *            *            *</div>
</div><!-- fragment --><p>If the histogram has (for example) 1024 bins two thinks can happen:</p><ul>
<li>the T0 is received before the end of the last bin, in this case the histogram index_of_the_bin is forced back to 0 and integration continue on bin 0</li>
<li>the T0 is not received before the end of the last bin, in this case the histogram integrate everithing in the last bin</li>
</ul>
<p>An TOF spectrum has the following parameters taken from the JSON file:</p><ul>
<li>the number of bins</li>
<li>the number of bits on the y-axis</li>
</ul>
<p>Number of bins and number of bits define the memory occupancy of the spectrum indeed they are defined at compile time by SciCompiler.</p>
<h1><a class="anchor" id="autotoc_md160"></a>
Parameters</h1>
<p>The following parameters can be configured:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Acces Mode   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">binwidth   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">set x-axis bin size in clock cycles, minimum 3   </td><td class="markdownTableBodyNone">10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">start_delay   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">set the start delay. Events between T0 and start_delay will be discarded   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bins   </td><td class="markdownTableBodyNone">R   </td><td class="markdownTableBodyNone">number of bins of the histogram   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">max_conts   </td><td class="markdownTableBodyNone">R   </td><td class="markdownTableBodyNone">maximum number of counts y-axes on the histogram   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">buffer_type   </td><td class="markdownTableBodyNone">R   </td><td class="markdownTableBodyNone">type of the buffer: (always decoded)   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h3><a class="anchor" id="autotoc_md161"></a>
Bin width</h3>
<p>The bin width is the x-axis bin size in clock cycles. The minimum bin width is 3 clock cycles. The bin width is set with the parameter <code>binwidth</code>. The bin width is used to calculate the time base of the histogram. The time base is calculated as follow: </p><pre class="fragment">binwidth * clock_period * index_of_the_bin
</pre><p> For example, if the <code>binwidth</code> is set to 10 and the clock of the board is 100 MHz, each bin will last 100ns.</p>
<h3><a class="anchor" id="autotoc_md162"></a>
Start delay</h3>
<p>The start delay is the minimum delay between the T0 and the first event. The start delay is set with the parameter <code>start_delay</code>. Any events before this delay are discarded. The histrogram start after the start delay. In any case, at least one clock cycle between T0 and first event must be present. The start delay is usefull to cut-off for example prompt gamma events or to compensate a delay between the T0 and the expected time of the first event in order to do not waste bins on the hisgram.</p>
<h2><a class="anchor" id="autotoc_md163"></a>
Commands</h2>
<p>The following commands are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Parameter    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">start   </td><td class="markdownTableBodyNone">start the histogram integration   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">stop   </td><td class="markdownTableBodyNone">suspend the histogram integration   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">reset   </td><td class="markdownTableBodyNone">reinitialize all bins in the histogram to 0   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h3><a class="anchor" id="autotoc_md164"></a>
Resets the histogram</h3>
<p><code>start</code> and <code>stop</code> commands do not reset the spectrum. They should be consideder as a start and pause of the spectrum. A <code>start</code> command after a <code>stop</code> command will continue the integration from the last bin value. In order to reset the spectrum it is necessary to use the <code>reset</code> command. The <code>reset</code> command reset all the bins in the histogram to 0.</p>
<h2><a class="anchor" id="autotoc_md165"></a>
Output data Format</h2>
<p>The ToF spectrum uses the same data structures of the energy spectrum </p>
<h3><a class="anchor" id="autotoc_md166"></a>
Decoded Data</h3>
<p>The data output structure is the following:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint32_t magic;</div>
<div class="line">    uint32_t *data;</div>
<div class="line">    uint64_t timecode;</div>
<div class="line">    uint32_t inttime;</div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        uint32_t buffer_size;</div>
<div class="line">        uint32_t total_bins;</div>
<div class="line">        uint32_t valid_bins;</div>
<div class="line">    } info;</div>
<div class="line">}<a class="code" href="struct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_SPECTRUM_DECODED_BUFFER</a>;</div>
<div class="ttc" id="astruct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___d_e_c_o_d_e_d___b_u_f_f_e_r_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_SPECTRUM_DECODED_BUFFER</a></div><div class="ttdoc">Spectrum decoded data.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:238</div></div>
</div><!-- fragment --><p>The <code>magic</code> field is a 32 bit value that identify the data format. The <code>data</code> field is a pointer to the data buffer. The data buffer is an array of 32 bit values. The number of elements in the array is defined by the <code>total_bins</code> field. The <code>valid_bins</code> field is the number of bins that contains data. The <code>valid_bins</code> field is always equal to <code>total_bins</code> field.</p>
<p><code>timecode</code> it's the epoch of the readout PC when the data is readout from the fpga. The timecode is expressed in milliseconds.</p>
<p>Data in the <code>data</code> array are the counts of each bin. The first element of the array is the bin with the lowest time. The last element of the array is the bin with the highest time in the spectrum. Each element of the array is a 32 bit value. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data Format    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bin 0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">bin 1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bin 2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">...    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bin n   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md167"></a>
Status</h2>
<p>The status of the spectrum is stored in a <a class="el" href="struct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___s_t_a_t_u_s.html" title="Spectrum status structure.">SCISDK_SPECTRUM_STATUS</a> structure.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">bool</span> running;                   </div>
<div class="line">    <span class="keywordtype">bool</span> completed;                 </div>
<div class="line">    uint32_t progress;              </div>
<div class="line">    uint32_t peak_max;              </div>
<div class="line">    uint32_t total_counter;         </div>
<div class="line">    <span class="keywordtype">double</span> integration_time;        </div>
<div class="line">}<a class="code" href="struct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___s_t_a_t_u_s.html">SCISDK_SPECTRUM_STATUS</a>;</div>
<div class="ttc" id="astruct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___s_t_a_t_u_s_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___s_t_a_t_u_s.html">SCISDK_SPECTRUM_STATUS</a></div><div class="ttdoc">Spectrum status structure.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:254</div></div>
</div><!-- fragment --><p>The <code>running</code> field is true if the spectrum is running. The <code>completed</code> field is always false.</p>
<p>The <code>progress</code> field is unused.</p>
<p>The <code>peak_max</code> field is the value of the bin with the highest count.</p>
<p>The <code>total_counter</code> field is the total number of counts in the histogram.</p>
<p>The <code>integration_time</code> field is the integration time of the spectrum in milliseconds.</p>
<p>The current version of the library do not report the <code>peak_max</code>, <code>total_counter</code>, <code>integration_time</code> fields. These fields are always 0.</p>
<h2><a class="anchor" id="autotoc_md168"></a>
Basic Examples</h2>
<p>The following example shows how to use the spectrum component.</p>
<h3><a class="anchor" id="autotoc_md169"></a>
C</h3>
<div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___s_p_e_c_t_r_u_m___d_e_c_o_d_e_d___b_u_f_f_e_r.html">SCISDK_SPECTRUM_DECODED_BUFFER</a> *obSpectrum;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> res = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0&quot;</span>, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d">T_BUFFER_TYPE_DECODED</a>, (<span class="keywordtype">void</span>**)&amp;obSpectrum, _sdk);</div>
<div class="line"><span class="keywordflow">if</span> (res != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.binwidth&quot;</span>, <span class="stringliteral">&quot;100&quot;</span>,_sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.start_delay&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>,_sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.reset&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk;</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0&quot;</span>, (<span class="keywordtype">void</span> *)obSpectrum, _sdk);</div>
<div class="line"> </div>
<div class="line">....</div>
<div class="line"> </div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ad1b5907dd78816dc2f481b44a99c2915">SCISDK_FreeBuffer</a>(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0&quot;</span>, 1, (<span class="keywordtype">void</span>**)&amp;obSpectrum, _sdk);</div>
<div class="ttc" id="a_n_i_error_code_8h_html_ae749d3c5e8d435a8bc05e47792d996d8"><div class="ttname"><a href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a></div><div class="ttdeci">#define NI_OK</div><div class="ttdef"><b>Definition:</b> NIErrorCode.h:8</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a00407547516aa0d9a26f273423366be3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterString(char *Path, char *value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a16a7364c71d331be2da443c61f7a25f3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ExecuteCommand(char *Path, char *value, void *handle)</div><div class="ttdoc">Execute a command for the specific Memory Mapped Component device driver/endpoint....</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_ac3f231d328ae4716a3d5910e00b44d7b"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_AllocateBuffer(char *Path, T_BUFFER_TYPE buffer_type, void **buffer, void *handle)</div><div class="ttdoc">Allocate a buffer to be used to store data from the board for the specific Memory Mapped Componet (os...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_ad1b5907dd78816dc2f481b44a99c2915"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#ad1b5907dd78816dc2f481b44a99c2915">SCISDK_FreeBuffer</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_FreeBuffer(char *Path, int buffer_type, void **buffer, void *handle)</div><div class="ttdoc">Release the memory allocated by SCISDK_AllocateBuffer() or SCISDK_AllocateBufferSize()</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_aeae6abf2d2a9a72799a64a3aa2d528c1"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ReadData(char *Path, void *buffer, void *handle)</div><div class="ttdoc">Read data from the board for the specific Memory Mapped Componet (oscilloscope, spectrum,...</div></div>
<div class="ttc" id="ascisdk__defines_8h_html_ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d"><div class="ttname"><a href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82ea64ff37ce78751f02ab09b50494a3c14d">T_BUFFER_TYPE_DECODED</a></div><div class="ttdeci">@ T_BUFFER_TYPE_DECODED</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:230</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md170"></a>
C++</h3>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   SCISDK_SPECTRUM_DECODED_BUFFER *obSpectrum;</div>
<div class="line">   </div>
<div class="line">   int res = sdk.AllocateBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, T_BUFFER_TYPE_DECODED, (void**)&amp;obSpectrum, _sdk);</div>
<div class="line">   if (res != NI_OK) {</div>
<div class="line">       cout &lt;&lt; &quot;Error allocating buffer&quot; &lt;&lt; endl;</div>
<div class="line">       return -1;</div>
<div class="line">   }</div>
<div class="line">   sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.binwidth&quot;, &quot;100&quot;,_sdk);</div>
<div class="line">   sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.start_delay&quot;, &quot;0&quot;, _sdk);</div>
<div class="line">   sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.reset&quot;, &quot;&quot;, _sdk;</div>
<div class="line">   sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.start&quot;, &quot;&quot;, _sdk);</div>
<div class="line">   sdk.ReadData(&quot;board0:/MMCComponents/TOF_0&quot;, (void *)obSpectrum, _sdk);</div>
<div class="line">   </div>
<div class="line">   ....</div>
<div class="line"> </div>
<div class="line">   sdk.FreeBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, 1, (void**)&amp;obSpectrum, _sdk);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md171"></a>
Python</h3>
<div class="fragment"><div class="line">res, obSpectrum = sdk.AllocateBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, T_BUFFER_TYPE_DECODED)</div>
<div class="line">if res != 0:</div>
<div class="line">    print(&quot;Error allocating buffer&quot;)</div>
<div class="line">    return -1</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.binwidth&quot;, &quot;100&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.start_delay&quot;, &quot;0&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.reset&quot;, &quot;&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.start&quot;, &quot;&quot;)</div>
<div class="line">res, obSpectrum = sdk.ReadData(&quot;board0:/MMCComponents/TOF_0&quot;, obSpectrum)</div>
<div class="line"> </div>
<div class="line">....</div>
<div class="line"> </div>
<div class="line">sdk.FreeBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, 1, obSpectrum)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md172"></a>
C Sharp</h3>
<div class="fragment"><div class="line">SCISDK_SPECTRUM_DECODED_BUFFER obSpectrum;</div>
<div class="line"> </div>
<div class="line">int res = sdk.AllocateBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, T_BUFFER_TYPE_DECODED, ref obSpectrum);</div>
<div class="line">if (res != 0) {</div>
<div class="line">    Console.WriteLine(&quot;Error allocating buffer&quot;);</div>
<div class="line">    return -1;</div>
<div class="line">}</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.binwidth&quot;, &quot;100&quot;);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.start_delay&quot;, &quot;0&quot;);</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.reset&quot;, &quot;&quot;);</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.start&quot;, &quot;&quot;);</div>
<div class="line">dk.ReadData(&quot;board0:/MMCComponents/TOF_0&quot;, ref obSpectrum);</div>
<div class="line"> </div>
<div class="line">....</div>
<div class="line"> </div>
<div class="line">sdk.FreeBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, 1, ref obSpectrum);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md173"></a>
VB.NET</h3>
<div class="fragment"><div class="line">Dim obSpectrum As SCISDK_SPECTRUM_DECODED_BUFFER</div>
<div class="line"> </div>
<div class="line">Dim res As Integer = sdk.AllocateBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, T_BUFFER_TYPE_DECODED, obSpectrum)</div>
<div class="line">If res &lt;&gt; 0 Then</div>
<div class="line">    Console.WriteLine(&quot;Error allocating buffer&quot;)</div>
<div class="line">    Return -1</div>
<div class="line">End If</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.binwidth&quot;, &quot;100&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/TOF_0.start_delay&quot;, &quot;0&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.reset&quot;, &quot;&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/TOF_0.start&quot;, &quot;&quot;)</div>
<div class="line">sdk.ReadData(&quot;board0:/MMCComponents/TOF_0&quot;, obSpectrum)</div>
<div class="line"> </div>
<div class="line">....</div>
<div class="line"> </div>
<div class="line">sdk.FreeBuffer(&quot;board0:/MMCComponents/TOF_0&quot;, 1, obSpectrum)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md174"></a>
JAVA</h3>
<div class="fragment"><div class="line">res = sdk.SetParameterInteger(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.binwidth&quot;</span>, 3);</div>
<div class="line">sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.start_delay&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line">sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.limitmode&quot;</span>, <span class="stringliteral">&quot;freerun&quot;</span>);</div>
<div class="line">sdk.SetParameterString(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.limit&quot;</span>, <span class="stringliteral">&quot;100&quot;</span>);</div>
<div class="line"> </div>
<div class="line">sdk.ExecuteCommand(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.reset&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">sdk.ExecuteCommand(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">Ref&lt;SpectrumDecodedBuffer&gt; buf = <span class="keyword">new</span> Ref&lt;&gt;(<span class="keyword">new</span> SpectrumDecodedBuffer());</div>
<div class="line"><span class="keywordtype">int</span> res = sdk.AllocateBuffer(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0&quot;</span>, buf);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(res == 0) {</div>
<div class="line">    res = sdk.ReadData(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0&quot;</span>, buf);</div>
<div class="line"> </div>
<div class="line">    ....</div>
<div class="line"> </div>
<div class="line">    sdk.FreeBuffer(<span class="stringliteral">&quot;board0:/MMCComponents/TOF_0&quot;</span>, buf);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md175"></a>
Labview</h3>
<p><img src="TOF-spectrum.PNG" alt="" class="inline"/></p>
<p><em>You can find the labview file for this example <a href="https://github.com/NuclearInstruments/SCISDK/tree/master/examples/components/LabView">here</a></em></p>
<h2><a class="anchor" id="autotoc_md176"></a>
Additional Examples</h2>
<h3><a class="anchor" id="autotoc_md177"></a>
Print spectrum</h3>
<p>This example print a spectrum every second. ```c </p><pre class="fragment">SCISDK_SPECTRUM_DECODED_BUFFER *obSpectrum;

int res = SCISDK_AllocateBuffer("board0:/MMCComponents/TOF_0", T_BUFFER_TYPE_DECODED, (void**)&amp;obSpectrum, _sdk);
if (res != NI_OK) {
    printf("Error allocating buffer\n");
    return -1;
}
SCISDK_SetParameterString("board0:/MMCComponents/TOF_0.binwidth", "100",_sdk);
SCISDK_SetParameterString("board0:/MMCComponents/TOF_0.start_delay", "0", _sdk);
SCISDK_ExecuteCommand("board0:/MMCComponents/TOF_0.reset", "", _sdk;
SCISDK_ExecuteCommand("board0:/MMCComponents/TOF_0.start", "", _sdk);

while (1) {
    //Just leave in your code of of two of this sleep functions
    usleep(1000*1000);  // LINUX: sleep for 1s
    Sleep(1000);        // WINDOWS: sleep for 1s 
    int res = SCISDK_ReadData("board0:/MMCComponents/TOF_0", (void *)obSpectrum, _sdk);
    if (res == NI_OK) {
        for (int i = 0; i &lt; obSpectrum-&gt;info.valid_bins; i++) {
            printf("[%5d] -- %9d\n", i, obSpectrum-&gt;data[i]);
        }
    }
}
SCISDK_FreeBuffer("board0:/MMCComponents/TOF_0", 1, (void**)&amp;obSpectrum, _sdk);
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
