<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>SciSDK Library: List driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/NuclearInstruments/SCISDK" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sci-compiler-logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SciSDK Library
   </div>
   <div id="projectbrief">SDK for SciCompiler projects</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_list.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">List driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The list allows to transfer data from FPGA to the PC in list mode.</p>
<p>In respect to Custom Packet or Frame, the list trasfer data in a raw mode: on the FPGA side it is possible to specify the number of bits of the inputs from 32 to 1024. The number of bit is defined in SciCompier and can not be changed at runtime.</p>
<p>On PC side the list provide a stream of bytes. Every time the list is readout every byte in the fifo is transferred to the PC.</p>
<p>The list is a FIFO buffer. The buffer is allocated in the FPGA and the data are transferred to the PC. On some board it is possible to enable DMA to speed up transfer. On the PC side a buffer can be allocated using the <code>SCISDK_AllocateBuffer</code> function. The buffer is freed using the <code>SCISDK_FreeBuffer</code> function.</p>
<p>Because the List is a FIFO is not possible to know a priori the number of bytes that will be transferred. The <code>SCISDK_AllocateBuffer</code> take indeed an extra parameter to specify the size of the buffer (in FPGA word) on the PC side; the <code>SCISDK_ReadData</code> function will try to read the maximum number of bytes that can fit in the buffer.</p>
<p><em>It is important to note that the buffer size is specified in FPGA word and not in bytes. The FPGA word size is specified in SciCompiler and it is the size of the data input signal. This is always a multiple of 32 bits (DWORD). All transfer will always be done with a size multiple of the FPGA word size (input signal size). This ensure that is not possible to read partial world that will corrupt data in an urecoverable way</em></p>
<p>The readout can be configure to work in two different mode:</p><ul>
<li>blocking : the <code>SCISDK_ReadData</code> function will block until the buffer is full or the timeout is reached.</li>
<li>non-blocking : the <code>SCISDK_ReadData</code> function will return immediately with the number of bytes read.</li>
</ul>
<p>More over the list can be configured to work:</p><ul>
<li>polling : the <code>SCISDK_ReadData</code> function will read the data from the hardware FIFO when the user call the function.</li>
<li>threaded : on start command, the list will start a thread that will read the data from the hardware FIFO and store it in an internal buffer (thread buffer). The <code>SCISDK_ReadData</code> function will read the data from the thread buffer. Thread mode increase the perfomance of the list because, while the use elaborate the previous data, the list accumulate next data in the thread buffer.</li>
</ul>
<h1><a class="anchor" id="autotoc_md146"></a>
Parameters</h1>
<p>The following parameters can be configured:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Acces Mode   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">acq_len   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">maximum number of sample to be transferred per physical FIFO access   </td><td class="markdownTableBodyNone">1024    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">acq_mode   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">select blocking/non-blocking mode   </td><td class="markdownTableBodyNone">blocking    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">timeout   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">set the timout in ms in blocking mode   </td><td class="markdownTableBodyNone">100    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">thread   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">enable the internal thread: true/false   </td><td class="markdownTableBodyNone">false    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">high_performance   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">if true the internal FIFO access lock the bus in priority mode.   </td><td class="markdownTableBodyNone">false    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">threaded_buffer_size   </td><td class="markdownTableBodyNone">R/W   </td><td class="markdownTableBodyNone">size in dword of the internal buffer   </td><td class="markdownTableBodyNone">100000    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">buffer_type   </td><td class="markdownTableBodyNone">R   </td><td class="markdownTableBodyNone">get buffer type: <a class="el" href="struct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___r_a_w___b_u_f_f_e_r.html" title="Oscilloscope raw data type.">SCISDK_OSCILLOSCOPE_RAW_BUFFER</a> or <a class="el" href="struct_s_c_i_s_d_k___o_s_c_i_l_l_o_s_c_o_p_e___d_e_c_o_d_e_d___b_u_f_f_e_r.html" title="Oscilloscope decoded data type.">SCISDK_OSCILLOSCOPE_DECODED_BUFFER</a>   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md147"></a>
Acquisition length</h2>
<p>The <code>acq_len</code> parameter is the maximum number of sample to be transferred per physical FIFO access. This parameter has an impact on the transfer speed. As bigger is the value, as faster is the transfer. Bigger value will lock the bus for a longer time and can cause a loss of data if the readout channel is shared between multiple readout block (for example multiple list or custom packet). The raccomanded value is the 90% size of the size of the internal FIFO. This parameter is expressed in double word (32 bit).</p>
<h2><a class="anchor" id="autotoc_md148"></a>
Blocking/Non blocking mode</h2>
<p>In blocking mode the <code>SCISDK_ReadData</code> function will block until the buffer is full or the timeout is reached. In non-blocking mode the <code>SCISDK_ReadData</code> function will return immediately with the number of bytes read. The maximum number of bytes that can be read is the size of the buffer allocated with the function <code>SCISDK_AllocateBuffer</code>. In blocking mode the timeout is set with the <code>timeout</code> parameter. The timeout is expressed in ms. In non-blocking mode the timeout is not used. In both mode, if the buffer is fill with even just a single word the function will return NI_OK. If there is no data at all the read function will return NI_NO_DATA_AVAILABLE.</p>
<h2><a class="anchor" id="autotoc_md149"></a>
Threaded mode</h2>
<p>In threaded mode the list will start a thread that will read the data from the hardware FIFO and store it in an internal buffer (thread buffer). The <code>SCISDK_ReadData</code> function will read the data from the thread buffer. While in polling mode, if the user do not call the <code>SCISDK_ReadData</code> function, the FIFO in the FPGA can be full and the data will be lost. In threaded mode the data are stored in the thread buffer automatically. The internall thread will poll the FPGA to check if data is available and will store it in the thread buffer. Thread mode increase the perfomance of the list because, but consume continuously the communication bandiwdth between the FPGA and the PC. The user lost the control on how much time the specific list will access to the shared bus.</p>
<h2><a class="anchor" id="autotoc_md150"></a>
High performance mode</h2>
<p>We discurage to enable this parameter. If enabled, the highe performace mode force the internal physical ReadFIFO function to ignore the word available field of the FIFO. When this parameter is disable, the ReadFIFO function check the word available field of the FIFO and will make a read only if this number if not 0. More over the read size will be the minimum between word available and acq_len parameter. In this way the ReadFIFO function will not lock the bus for a long time. In high perforamnce mode, the ReadFIFO will always setup a read cycle with size equal to acq_len parameter. This will lock the bus for a long time untill all data are received. This will increase significantly the transfer speed but no other access, even to read/write register can be done until all data are received or the timeout is reached. Use this mode only if you are sure that the bus is not shared with other readout block and you don't need</p>
<h1><a class="anchor" id="autotoc_md151"></a>
Commands</h1>
<p>The following commands are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Parameter    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">start   </td><td class="markdownTableBodyNone">Clear the FIFO and start the acqusition   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">stop   </td><td class="markdownTableBodyNone">Stop the acquisition   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Start will clear the list content, create the internal thread and allocate the thread buffer if thread mode is enable and start the acquisition. All list parameter can not be changed while the acquisition is in progress. Stop the list before change any parameter or the property set will be rejected.</p>
<h1><a class="anchor" id="autotoc_md152"></a>
Buffer Allocation</h1>
<p>The buffer is allocated using the <code>SCISDK_AllocateBuffer</code> function. The buffer is freed using the <code>SCISDK_FreeBuffer</code> function. Because the List is a FIFO is not possible to know a priori the number of bytes that will be transferred. The <code>SCISDK_AllocateBuffer</code> take indeed an extra parameter to specify the size of the buffer (in word) on the PC side; the <code>SCISDK_ReadData</code> function will try to read the maximum number of bytes that can fit in the buffer.</p>
<p>The list support just RAW data. The data struct cointains a char* filed (array of char). The user must cast or convert it to correctly rappresents the data from the FPGA</p>
<p>This is an example on how allocate a List Buffer: </p><div class="fragment"><div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(&lt;path to list&gt;, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;list_data, &lt;number of word&gt;)</div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_ac3f231d328ae4716a3d5910e00b44d7b"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_AllocateBuffer(char *Path, T_BUFFER_TYPE buffer_type, void **buffer, void *handle)</div><div class="ttdoc">Allocate a buffer to be used to store data from the board for the specific Memory Mapped Componet (os...</div></div>
<div class="ttc" id="ascisdk__defines_8h_html_ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c"><div class="ttname"><a href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a></div><div class="ttdeci">@ T_BUFFER_TYPE_RAW</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:229</div></div>
</div><!-- fragment --><p>The buffer allocated with the <code>SCISDK_AllocateBuffer</code> function has a last size parameters containing the number of word the user want to allocate in the buffer. For example if the user create in SciCompiler a list with 64 bit words and want to allocate a buffer with 1000 words, the function will allocate a buffer with 8000 bytes. The <code>SCISDK_ReadData</code> function will try to fill the buffer with 8000 bytes (1000 words * 8 bytes) each time is called.+ It is crtical to ensure that the transfer will always be aligned to the word size to avoid to read partial words with irrecoverable data loss.</p>
<p>This example allocate a buffer with 1000 words:</p>
<div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html">SCISDK_LIST_RAW_BUFFER</a> list_data;</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#ac3f231d328ae4716a3d5910e00b44d7b">SCISDK_AllocateBuffer</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;list_data, 1000)</div>
<div class="ttc" id="astruct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r_html"><div class="ttname"><a href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html">SCISDK_LIST_RAW_BUFFER</a></div><div class="ttdoc">List raw data type.</div><div class="ttdef"><b>Definition:</b> scisdk_defines.h:155</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md153"></a>
Output data Format</h1>
<h2><a class="anchor" id="autotoc_md154"></a>
Raw Data</h2>
<p>The data output structure is the following: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint32_t magic;             </div>
<div class="line">    <span class="keywordtype">char</span> *data;                     </div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        uint32_t buffer_size;       </div>
<div class="line">        uint32_t samples;           </div>
<div class="line">        uint32_t valid_samples;     </div>
<div class="line">        uint32_t channels;          </div>
<div class="line">    } info;</div>
<div class="line">}<a class="code" href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html">SCISDK_LIST_RAW_BUFFER</a>;</div>
</div><!-- fragment --><p> <code>magic</code> : magic number to identify the buffer type. It is set to SCISDK_LIST_RAW_BUFFER_MAGIC <code>data</code> : it's the array of the raw data. The data is stored as a char array. The user must cast it to the correct type. For example if input signal size is 64 bit, the user must cast the data to uint64_t*. This example show how to cast the data to uint64_t*: </p><div class="fragment"><div class="line">uint64_t *data = (uint64_t*)list_data-&gt;data;</div>
<div class="line">for (<span class="keywordtype">int</span> i = 0; i &lt; list_data-&gt;info.valid_samples; i++) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i]);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the size of the input signal is greater than 64 bit, several programming language offer buffer data type or the user can treat it as an array of char. Another option is to use pack struct. Immagine that the input size is 128 bits organized as follows:</p>
<ul>
<li>64 bit for the timestamp</li>
<li>32 bit for the energy</li>
<li>8 bit for the channel</li>
<li>16 bit for the flags</li>
</ul>
<p>This example show how to cast the data to a pack struct:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><span class="preprocessor">#define PACK( __Declaration__ ) __pragma( pack(push, 1) ) __Declaration__ __pragma( pack(pop))</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define PACK( __Declaration__ ) __Declaration__ __attribute__((__packed__))</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">PACK(<span class="keyword">typedef</span> <span class="keyword">struct</span> DATA_STRUCT {</div>
<div class="line">    uint64_t timestramp;</div>
<div class="line">    uint32_t energy;</div>
<div class="line">    uint8_t channel;</div>
<div class="line">    uint16_t flags;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">DATA_STRUCT *data = (DATA_STRUCT*)list_data-&gt;data;</div>
<div class="line">for (<span class="keywordtype">int</span> i = 0; i &lt; list_data-&gt;info.valid_samples; i++) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].timestramp);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].energy);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].channel);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].flags);</div>
<div class="line">}</div>
</div><!-- fragment --><p>It is even possible to work at bit level to specify exactly the bit meaning of each element Imagine we have a 32 bit word with following bit organization:</p><ul>
<li>8 bit channel</li>
<li>1 bit valid</li>
<li>1 bit pileup</li>
<li>1 bit overflow</li>
<li>1 bit veto marker</li>
<li>3 bit padding to zero</li>
<li>16 bit energy</li>
</ul>
<p>This example show how to cast the data to a pack struct:</p>
<div class="fragment"><div class="line">PACK(<span class="keyword">typedef</span> <span class="keyword">struct</span> DATA_STRUCT {</div>
<div class="line">    uint8_t channel:8;</div>
<div class="line">    uint8_t valid:1;</div>
<div class="line">    uint8_t pileup:1;</div>
<div class="line">    uint8_t overflow:1;</div>
<div class="line">    uint8_t veto_marker:1;</div>
<div class="line">    uint8_t padding:3;</div>
<div class="line">    uint16_t energy:16;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">DATA_STRUCT *data = (DATA_STRUCT*)list_data-&gt;data;</div>
<div class="line"> </div>
<div class="line">for (<span class="keywordtype">int</span> i = 0; i &lt; list_data-&gt;info.valid_samples; i++) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].channel);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].valid);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].pileup);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].overflow);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].veto_marker);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].energy);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md155"></a>
Basic Examples</h1>
<h2><a class="anchor" id="autotoc_md156"></a>
C</h2>
<div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html">SCISDK_LIST_RAW_BUFFER</a> *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>), <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 1024);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.timeout&quot;</span>, 5000, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk);   </div>
<div class="ttc" id="a_n_i_error_code_8h_html_ae749d3c5e8d435a8bc05e47792d996d8"><div class="ttname"><a href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a></div><div class="ttdeci">#define NI_OK</div><div class="ttdef"><b>Definition:</b> NIErrorCode.h:8</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a00407547516aa0d9a26f273423366be3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterString(char *Path, char *value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a0f722da8b5e19540555298e0806bb45f"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_SetParameterInteger(char *Path, int value, void *handle)</div><div class="ttdoc">Set the value of a parameter for the specific SciCompiler Memory Mapped Component or route the value ...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a16a7364c71d331be2da443c61f7a25f3"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ExecuteCommand(char *Path, char *value, void *handle)</div><div class="ttdoc">Execute a command for the specific Memory Mapped Component device driver/endpoint....</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_a612babf059fa19eaac91fae6da160f85"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_AllocateBufferSize(char *Path, T_BUFFER_TYPE buffer_type, void **buffer, void *handle, int size)</div><div class="ttdoc">Allocate a buffer to be used to store data from the board for the specific Memory Mapped Componet (li...</div></div>
<div class="ttc" id="a_sci_s_d_k___d_l_l_8h_html_aeae6abf2d2a9a72799a64a3aa2d528c1"><div class="ttname"><a href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a></div><div class="ttdeci">SCISDK_DLL_API int SCISDK_ReadData(char *Path, void *buffer, void *handle)</div><div class="ttdoc">Read data from the board for the specific Memory Mapped Componet (oscilloscope, spectrum,...</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md157"></a>
C++</h2>
<div class="fragment"><div class="line"><a class="code" href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html">SCISDK_LIST_RAW_BUFFER</a> *lrb;</div>
<div class="line">sdk-&gt;AllocateBuffer(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>, <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;lrb, 1024);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.timeout&quot;</span>, 5000);</div>
<div class="line">sdk-&gt;SetParameter(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>);</div>
<div class="line">sdk-&gt;ExecuteCommand(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> res = sdk-&gt;ReadData(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (res != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error reading data\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md158"></a>
Python</h2>
<div class="fragment"><div class="line">res, lrb = sdk.AllocateBuffer(&quot;board0:/MMCComponents/List_0&quot;, 1024)</div>
<div class="line"> </div>
<div class="line">if res != 0:</div>
<div class="line">    print(&quot;Error allocating buffer&quot;)</div>
<div class="line">    exit(-1)</div>
<div class="line"> </div>
<div class="line">sdk.SetParameterString(&quot;board0:/MMCComponents/List_0.thread&quot;, &quot;false&quot;)</div>
<div class="line">sdk.SetParameterInteger(&quot;board0:/MMCComponents/List_0.timeout&quot;, 5000)</div>
<div class="line">sdk.SetParameterString(&quot;board0:/MMCComponents/List_0.acq_mode&quot;, &quot;blocking&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/List_0.start&quot;, &quot;&quot;)</div>
<div class="line"> </div>
<div class="line">res, lrb = sdk.ReadData(&quot;board0:/MMCComponents/List_0&quot;, lrb)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md159"></a>
C Sharp</h2>
<div class="fragment"><div class="line">SciSDKListRawBuffer lrb = new SciSDKListRawBuffer();</div>
<div class="line">sdk.AllocateBuffer(&quot;board0:/MMCComponents/List_0&quot;, 0, ref lrb, 1024);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/List_0.thread&quot;, &quot;false&quot;);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/List_0.timeout&quot;, 5000);</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/List_0.acq_mode&quot;, &quot;blocking&quot;);</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/List_0.start&quot;, &quot;&quot;);</div>
<div class="line"> </div>
<div class="line">int res = sdk.ReadData(&quot;board0:/MMCComponents/List_0&quot;, ref lrb);</div>
<div class="line"> </div>
<div class="line">if (res != 0) {</div>
<div class="line">    Console.WriteLine(&quot;Error reading data&quot;);</div>
<div class="line">    return -1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md160"></a>
VB.NET</h2>
<div class="fragment"><div class="line">Dim lrb As New SciSDKListRawBuffer()</div>
<div class="line">sdk.AllocateBufferSize(&quot;board0:/MMCComponents/List_0&quot;, 0, lrb, 1024)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/List_0.thread&quot;, &quot;false&quot;)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/List_0.timeout&quot;, 5000)</div>
<div class="line">sdk.SetParameter(&quot;board0:/MMCComponents/List_0.acq_mode&quot;, &quot;blocking&quot;)</div>
<div class="line">sdk.ExecuteCommand(&quot;board0:/MMCComponents/List_0.start&quot;, &quot;&quot;)</div>
<div class="line"> </div>
<div class="line">Dim res As Integer = sdk.ReadData(&quot;board0:/MMCComponents/List_0&quot;, lrb)</div>
<div class="line"> </div>
<div class="line">If res &lt;&gt; 0 Then</div>
<div class="line">    Console.WriteLine(&quot;Error reading data&quot;)</div>
<div class="line">    Return -1</div>
<div class="line">End If</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md161"></a>
Additional Examples</h1>
<h2><a class="anchor" id="autotoc_md162"></a>
Decode list data in C</h2>
<p>A multichannel system is used to detect neutron and gamma. Neutron has a longer dacay time and gamma has a shorter decay time. The system will use a charge integrator with two time windows to calculate Qshoe and Qlong.</p>
<p>Decode a 64 bit list data with the following bit organization:</p><ul>
<li>5 bit channel</li>
<li>1 bit valid</li>
<li>1 bit pileup</li>
<li>1 padding</li>
<li>24 bit timestamp</li>
<li>16 bit Qshort</li>
<li>16 bit Qlong</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><span class="preprocessor">#define PACK( __Declaration__ ) __pragma( pack(push, 1) ) __Declaration__ __pragma( pack(pop))</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define PACK( __Declaration__ ) __Declaration__ __attribute__((__packed__))</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">PACK(<span class="keyword">typedef</span> <span class="keyword">struct</span> DATA_STRUCT {</div>
<div class="line">    uint8_t channel:5;</div>
<div class="line">    uint8_t valid:1;</div>
<div class="line">    uint8_t pileup:1;</div>
<div class="line">    uint8_t padding:1;</div>
<div class="line">    uint32_t timestamp:24;</div>
<div class="line">    uint16_t qshort:16;</div>
<div class="line">    uint16_t qlong:16;</div>
<div class="line">}DATA_STRUCT);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html">SCISDK_LIST_RAW_BUFFER</a> *lrb;</div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#a612babf059fa19eaac91fae6da160f85">SCISDK_AllocateBufferSize</a>((<span class="keywordtype">char</span>*)(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>), <a class="code" href="scisdk__defines_8h.html#ae862720a4aac4f0f7472fc81ccc2b82eaf0dd46bc0744f52a1c3a06194e8b115c">T_BUFFER_TYPE_RAW</a>, (<span class="keywordtype">void</span>**)&amp;lrb, _sdk, 1024);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error allocating buffer\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.thread&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a0f722da8b5e19540555298e0806bb45f">SCISDK_SetParameterInteger</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.timeout&quot;</span>, 5000, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a00407547516aa0d9a26f273423366be3">SCISDK_SetParameterString</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.acq_mode&quot;</span>, <span class="stringliteral">&quot;blocking&quot;</span>, _sdk);</div>
<div class="line"><a class="code" href="_sci_s_d_k___d_l_l_8h.html#a16a7364c71d331be2da443c61f7a25f3">SCISDK_ExecuteCommand</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0.start&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, _sdk);</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="_sci_s_d_k___d_l_l_8h.html#aeae6abf2d2a9a72799a64a3aa2d528c1">SCISDK_ReadData</a>(<span class="stringliteral">&quot;board0:/MMCComponents/List_0&quot;</span>, (<span class="keywordtype">void</span> *)lrb, _sdk);</div>
<div class="line"><span class="keywordflow">if</span> (ret == <a class="code" href="_n_i_error_code_8h.html#ae749d3c5e8d435a8bc05e47792d996d8">NI_OK</a>) {</div>
<div class="line">    </div>
<div class="line">DATA_STRUCT *data = (DATA_STRUCT*)list_data-&gt;data;</div>
<div class="line"> </div>
<div class="line">    for (<span class="keywordtype">int</span> i = 0; i &lt; list_data-&gt;info.valid_samples; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].channel);</div>
<div class="line">        printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].valid);</div>
<div class="line">        printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].pileup);</div>
<div class="line">        printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].timestamp);</div>
<div class="line">        printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].qshort);</div>
<div class="line">        printf(<span class="stringliteral">&quot;%d\n&quot;</span>, data[i].qlong);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md163"></a>
Use non-blocking mode in C</h2>
<p>```c <a class="el" href="struct_s_c_i_s_d_k___l_i_s_t___r_a_w___b_u_f_f_e_r.html" title="List raw data type.">SCISDK_LIST_RAW_BUFFER</a> <em>lrb; ret = SCISDK_AllocateBufferSize((char</em>)("board0:/MMCComponents/List_0"), T_BUFFER_TYPE_RAW, (void**)&amp;lrb, _sdk, 100);</p>
<p>if (ret != NI_OK) { printf("Error allocating buffer\n"); return -1; }</p>
<p>SCISDK_SetParameterString("board0:/MMCComponents/List_0.thread", "false", _sdk); SCISDK_SetParameterString("board0:/MMCComponents/List_0.acq_mode", "non-blocking", _sdk); SCISDK_ExecuteCommand("board0:/MMCComponents/List_0.start", "", _sdk);</p>
<p>while (1) { ret = SCISDK_ReadData("board0:/MMCComponents/List_0", (void *)lrb, _sdk); if (ret == NI_OK) { uint32_t <em>data; data = (uint32_t</em>)list_data-&gt;data; for (int i = 0; i &lt; list_data-&gt;info.valid_samples; i++) { printf("%d\n", data[i]); } } } </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
